基于时空数据挖掘的城市路网交 通态势分析及应用研究
(申请清华大学工学博士学位论文)

培 养 单 位： 土木工程系

学

科 ： 土木工程

研 究 生： 杨 森 炎

指 导 教 师： 吴 建 平 教 授

二○一九年六月

Research on Traffic Situation Analysis and Application for Urban Road Network
through Spatio-temporal Data Mining
Dissertation Submitted to Tsinghua University
in partial fulfillment of the requirement for the degree of
Doctor of Philosophy in
Civil Engineering
by Yang Senyan Dissertation Supervisor: Professor Wu Jianping
June, 2019

摘要
摘要
城市路网交通系统是一个高度复杂的非线性系统，准确评估路网时空交通态 势，深入挖掘其复杂的运行规律，对于提高城市交通运行效率和智能化管理水平具 有重要的理论意义和实用价值。随着感知、通信及智能计算技术的快速发展，如何 从海量、高维、多样化的交通时空数据中挖掘潜在的交通状态变化模式和特征，为 交通管理部门和公众出行提供高效准确的信息服务，是智能交通领域面临的重要 挑战。本研究从数据驱动的角度，采用先进的机器学习、信息论等数据挖掘和分析 方法，结合交通流理论和网络理论，提出了基于时空数据挖掘的城市道路网络交通 态势分析及应用的研究框架。本文按“时空特征提取—因果关系挖掘—频繁模式识 别—未来状态预测”的逻辑主线展开研究。
首先，提出一种基于非负张量分解考虑路网交通状态多维度特征的同质时空 模式提取方法。在时间维度上提取了长期和短期变化特征，在空间维度上定义空间 邻近系数，修正高斯相似度矩阵。基于改进的谱聚类算法将城市大范围路网分割为 具备同质交通时空状态模式的子路网。其次，构建考虑信息传递方向性的路网时空 状态因果关系挖掘方法。引入传递熵算法量化交通状态时空因果关系，利用滑动窗 口技术和高斯核密度估计的方法计算传递熵矩阵，表征各路段之间的动态信息传 递量。提出被影响系数、影响系数、输入度及输出度指标，识别路网上的关键路段。 随后，提出基于时空因果关系挖掘的交通拥堵传播模式识别模型。利用传递熵计算 交通状态信息传递量以及拥堵事件之间的因果关联性强度。考虑拥堵事件发生时 间的连续性和空间拓扑的连通性约束条件，基于因果关系显著性检验去除冗余的 关联关系，建立路网交通拥堵状态时空传播有向图集。采用频繁子图挖掘算法，识 别频繁拥堵状态时空传播模式。最后，构建考虑时空信息的城市路网交通状态预测 模型。选择历史上下游交通流量作为特征变量，利用梯度提升决策树集成学习算法， 预测短时交通流量，并识别变量的重要性。基于传递熵的变量选择方法提取贡献度 高的时空特征变量，显著降低了模型的特征维度和复杂度，提高了预测精度和效率。
本研究为交通时空数据挖掘和分析提供了系统性的研究思路和方法，促进了 交通态势建模与时空数据挖掘的交叉融合，为城市交通拥堵治理、路网规划等提供 决策支持，为数据驱动下的智能交通系统提供基础技术支撑。
关键词：时空数据挖掘；多维特征提取；时空因果关系；拥堵传播；交通流预测
I

Abstract
Abstract
Urban road network traffic system is a highly complex nonlinear system. Accurately assessing the spatio-temporal traffic situation of road network and deeply mining its complex operation regularity has important theoretical significance and practical value for improving traffic operation efficiency and intelligent traffic management technology. With the rapid development of sensing, communication and intelligent computing technologies, how to explore the potential traffic evolution patterns and characteristics from massive, high-dimensional, and diverse spatio-temporal traffic data, and provide efficient and accurate information services for traffic management departments and travelers is a significant challenge in the field of intelligent transportation. This study proposes a data-driven research framework for the research on traffic situation analysis and application for urban road network through spatio-temporal data mining, applying the advanced machine learning, information theory and other data mining and analysis methods, combined with traffic flow theory and network theory. The thesis is organized according to the logic thread, as follows: spatio-temporal feature extraction, causal relationship mining, frequent pattern recognition and future state prediction.
Firstly, a homogenous spatiotemporal pattern extraction method based on nonnegative tensor decomposition is proposed considering the multi-dimensional characteristics of road network traffic state. The long-term and short-term variation features are respectively extracted in temporal dimension. The spatial proximity coefficient is defined in the spatial dimension to modify the Gaussian similarity matrix. The large-scale urban road network is divided into sub-networks with homogeneous spatio-temporal traffic flow pattern based on the improved spectral clustering algorithm. Secondly, a spatio-temporal causality mining model is established for urban road network traffic flow considering the direction of information transmission. The transfer entropy algorithm is introduced to quantify the spatio-temporal causality of traffic state. The sliding window technique and Gaussian kernel density estimation method are used to calculate the transfer entropy matrix, characterizing the dynamic information transmission between any two segments. The affected coefficient, influence coefficient, input degree and output degree indexes are proposed to identify the key sections of the
II

Abstract
road network. Thirdly, a traffic congestion propagation pattern recognition model is proposed based on spatio-temporal causality mining. The transfer entropy is used to calculate the amount of traffic state information transmission and the intensity of causal correlation between traffic congestion events. Considering the constraints including the continuity of the occurrence time and the connectivity of the spatial topology for the congestion events, the redundant correlation relationship is removed based on the causality significance test, and the directed graphs of spatio-temporal traffic congestion propagation for the road network is established. The frequent subgraph mining algorithm is used to identify the frequent spatio-temporal traffic congestion propagation patterns. Finally, a traffic flow predictive model for urban road network considering spatial and temporal information is constructed. The historical upstream and downstream traffic flow parameters are selected as the input variable, and the gradient boosting decision trees (GBDT), an ensemble learning algorithm, is applied to predict the short-term traffic flow and identify the importance of variables. Then the spatiotemporal feature variables with high contribution degree are extracted by the variable selection method based on the transfer entropy, significantly reducing the feature dimension and complexity of the model, and improving the prediction accuracy and efficiency.
This study provides a systematic research framework and methods for spatiotemporal traffic data mining and analysis, and promotes the fusion of traffic situation modeling and spatio-temporal data mining, providing the scientific decision support for urban traffic congestion control and road network planning, and the basic technology support for data-driven intelligent transportation systems.
Key words: spatio-temporal data mining; multi-dimensional feature extraction; spatiotemporal causality; traffic congestion propagation; traffic flow prediction
III

目录
目 录
第 1 章 绪论 .................................................................................................................... 1 1.1 研究背景 ............................................................................................................... 1 1.2 研究问题、目的及意义 ....................................................................................... 3 1.3 国内外研究现状 ................................................................................................... 6 1.3.1 交通状态时空变化规律研究 ........................................................................ 6 1.3.2 交通状态时空特征提取方法 ........................................................................ 7 1.3.3 交通时空状态因果关系挖掘 ........................................................................ 9 1.3.4 交通拥堵状态传播模型研究 ...................................................................... 10 1.3.5 短时交通流状态预测研究 .......................................................................... 12 1.4 研究内容与技术路线 ......................................................................................... 15
第 2 章 城市路网交通时空数据特征及处理技术 ...................................................... 19 2.1 交通数据时空特性分析 ..................................................................................... 19 2.1.1 时间维特性 .................................................................................................. 19 2.1.2 空间维特性 .................................................................................................. 20 2.1.3 时空相关性 .................................................................................................. 21 2.2 路网属性 ............................................................................................................. 22 2.3 实验数据介绍 ..................................................................................................... 22 2.4 数据预处理过程 ................................................................................................. 25 2.4.1 异常数据检测 .............................................................................................. 26 2.4.2 数据融合及修复 .......................................................................................... 27 2.4.3 数据滤波处理 .............................................................................................. 28 2.4.4 数据预处理实例 .......................................................................................... 29 2.5 本章小结 ............................................................................................................. 31
第 3 章 考虑时空多维度特征的同质交通状态变化模式提取 .................................. 32 3.1 本章引言 ............................................................................................................. 32 3.2 基于张量分解的多维度特征提取 ..................................................................... 34 3.2.1 NNCP 算法 ................................................................................................... 34 3.2.2 分解技术 ...................................................................................................... 35 3.3 考虑空间邻近性的谱聚类算法 ......................................................................... 36
IV

目录
3.3.1 构建相似度图 .............................................................................................. 36 3.3.2 SC-SPM 算法................................................................................................ 38 3.4 宏观路网交通流参数 ......................................................................................... 39 3.5 实验分析 ............................................................................................................. 40 3.5.1 非负张量分解 .............................................................................................. 40 3.5.2 参数敏感性分析 .......................................................................................... 42 3.5.3 交通流变化模式分析 .................................................................................. 45 3.5.4 子路网的宏观交通流关系 .......................................................................... 49 3.5.5 高峰期与非高峰期的交通模式 .................................................................. 54 3.6 本章小结 ............................................................................................................. 57
第 4 章 基于传递熵算法的交通状态时空因果关系挖掘 .......................................... 58 4.1 本章引言 ............................................................................................................. 58 4.2 传递熵模型 ......................................................................................................... 60 4.2.1 信息熵基本概念 .......................................................................................... 60 4.3.2 传递熵理论 .................................................................................................. 62 4.3.3 传递熵计算方法 .......................................................................................... 63 4.3.4 因果关系判断方法 ...................................................................................... 64 4.4 路网交通状态时空因果关系建模 ..................................................................... 66 4.5 实验分析 ............................................................................................................. 67 4.5.1 参数分析 ...................................................................................................... 67 4.5.2 动态因果关系分析 ...................................................................................... 70 4.5.3 城市路网时空因果关系分析 ...................................................................... 72 4.6 本章小结 ............................................................................................................. 80
第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别 .............................. 82 5.1 本章引言 ............................................................................................................. 82 5.2 路网交通拥堵状态时空传播图构建 ................................................................. 84 5.2.1 交通拥堵指数 .............................................................................................. 84 5.2.2 时空拥堵状态矩阵 ...................................................................................... 85 5.2.3 路网空间邻接矩阵 ...................................................................................... 86 5.2.4 时空因果关系连接矩阵 .............................................................................. 87 5.2.5 交通拥堵状态时空传播图 .......................................................................... 89 5.3 频繁交通拥堵传播模式挖掘 ............................................................................. 92
V

目录
5.3.1 频繁子图挖掘算法 ...................................................................................... 92 5.3.2 实验分析 ...................................................................................................... 94 5.4 交通拥堵时空状态关联模式挖掘 ................................................................... 100 5.5 本章小结 ........................................................................................................... 102 第 6 章 考虑时空信息的城市路网交通状态预测 .................................................... 104 6.1 本章引言 ........................................................................................................... 104 6.2 集成学习模型 ................................................................................................... 105 6.3 考虑上下游交通状态影响的集成预测模型 ................................................... 109 6.3.1 实验数据 .................................................................................................... 109 6.3.2 参数分析 .....................................................................................................111 6.3.3 实验分析 .....................................................................................................113 6.4 基于时空变量选择的联合预测模型 ............................................................... 122 6.4.1 模型框架 .................................................................................................... 123 6.4.2 时空变量选择 ............................................................................................ 124 6.4.3 实验分析 .................................................................................................... 125 6.5 本章小结 ........................................................................................................... 131 第 7 章 总结与展望 .................................................................................................... 133 7.1 论文总结 ........................................................................................................... 133 7.2 研究创新点 ....................................................................................................... 134 7.3 研究展望 ........................................................................................................... 136 参考文献 ...................................................................................................................... 137 致谢 .............................................................................................................................. 149 声明 .............................................................................................................................. 150 个人简历、在校期间发表的学术论文与研究成果 .................................................. 151
VI

第 1 章 绪论
第 1 章 绪论
1.1 研究背景
城市道路交通系统是支撑城市正常运转的重要基础性设施，保证居民的日常 出行和货物运输等基本任务的正常运转，以及城市社会经济的平稳发展。城市道路 网络是城市的骨架，随着基础设施逐渐成熟，每年新增路段有限，路网趋于饱和， 全国的道路长度和面积缓慢增长，如图 1.1 所示。随着我国进入“十三五”建设的 关键阶段，新型城镇化建设全面展开，居民生活水平日益提高，机动车的保有量持 续快速增加，全国的私人汽车拥有量如图 1.2 所示。我国车辆的增长速度大于道路 长度及面积的增长速度，因此道路交通供给无法满足持续增长的居民交通出行需 求，供需矛盾日益突出，直接导致了交通拥堵、交通事故频繁、车辆能源消耗大以 及尾气排放严重等一系列城市问题，制约社会经济的发展和居民生活水平的提高。
目前我国城市道路交通系统高峰时期大部分道路处于交通流饱和状态，甚至 发生严重的交通拥堵，但部分道路交通畅通，车流量较小，城市道路网络的通行能 力没有得以充分利用，这种现象主要是由交通需求时空分布的不均衡性导致。高德 地图发布的《2016 年度中国主要城市交通分析报告》中指出，全国三分之一的城 市通勤时段交通拥堵明显，其中 4 个城市高峰时期拥堵延时指数超过 2.0，一线大 城市和重点省会城市的拥堵程度高于中小城市，中国主要城市拥堵地图如图 1.3 所 示[1]。交通拥堵发生的原因一方面可能是道路网结构设计不合理，通行能力不足， 导致向上游方向车流排队后溢，交通拥堵状态可能会向相邻路段传播，交通阻塞事 件频繁发生，形成拥堵瓶颈；另一方面，可能由于突发事件或者事故导致一定空间 范围内的路段发生拥堵，进而引起大面积的拥堵瘫痪。
图1.1 全国道路长度和面积变化图 1

第 1 章 绪论
图1.2 全国私人汽车拥有量变化图
图1.3 中国主要城市高峰期拥堵地图[1] 城市路网交通态势是指路网历史和当前的交通状态以及未来的演变趋势，具 有复杂动态的时空变化特征。态势理论最早出现在军事、航空等领域，具有代表性 的研究是态势评估三级功能模型，即态势感知、态势理解和态势预测[2]。随着信息 化时代的来临，在数据驱动的智能交通系统中，处于物理感知层的传感器实时采集 交通状态数据，传输并存储交通状态时空信息；在应用层，基于海量的时空数据， 使用数据挖掘技术，完成数据清洗、集成、融合等预处理工作，对路网的时空状态 模式进行分析；最后在分析预测层，充分利用时空信息实现对路网态势实时精准的 分析和预测，用于支持交通预警、诱导及决策等功能。因此，可以将态势的概念引 入城市路网交通智能化管理和应用中来。精准化地感知、监控及预测路网交通态势
2

第 1 章 绪论
对于制定交通控制诱导策略，优化路网设计，最大限度提高现有路网的利用效率和 交通运行效率，改善居民出行环境至关重要，一直以来是智能交通领域的研究热点。
随着传感技术在交通领域的普及应用，大量的不同类型的传感器采集了多源 异构的交通时空数据，例如感应线圈、车载 GPS 和手机[3]，使得城市交通数据环 境呈现大数据的特征，促进了交通大数据研究的兴起，以及数据驱动智能交通系统 的发展[4]。2016 年 4 月，交通运输部出台的《交通运输信息化“十三五”发展规 划》中指出随着“互联网+”促进交通运输行业转型升级，需要进一步促进行业数 据资源的开放和共享，进一步推动交通运输数据资源开放共享平台和综合交通服 务大数据平台的建设。为了促进交通大数据的发展和应用，2016 年 11 月交通运输 部与百度地图推出了首个交通出行大数据平台“出行云”[5]。2017 年 3 月，综合交 通大数据应用技术国家工程实验室成立[6]。这些要举措促进了中国交通运输数据开 放迈出了重要一步。同时交通大数据研究目前已成为全世界智能化交通领域的研 究热点，一方面，智能交通系统可以产生大量多样而复杂的数据；另一方面，大数 据分析技术可以提高智能交通系统的运行效率和安全水平，对智能交通系统的设 计和应用产生深远影响[7]。
海量的交通时空数据和智能化的数据挖掘技术为城市路网交通态势分析提供 了一个新的发展契机。传统的模型机理类研究依赖于大量的主观假设，缺乏验证， 且模型复杂。由多样化高精度的传感器设备采集得到的高维时空数据可以支撑路 网交通态势建模从模型驱动逐步转换到数据驱动的研究范式。庞大的数据规模、数 据的多样性及不确定性加大了挖掘分析的难度，给计算能力带来较大的挑战，因此 需要进一步探索有效的智能计算方法从海量数据中提取有潜在的交通状态时空演 变规律和特征。基于时空数据挖掘的城市路网交通态势分析及预测建模是智能交 通技术研究及应用的重要发展趋势。
1.2 研究问题、目的及意义
城市路网交通系统具有复杂的静态路网拓扑结构和动态交通状态时空变化特 征。本文从数据挖掘的角度，面向城市道路交通网络，考虑城市路网交通流复杂的 时空特性，采用先进的机器学习、信息论等方法论，结合交通流理论，深入挖掘网 络交通流所蕴含的丰富交通信息。基于大量的交通检测器数据和路网空间拓扑结 构数据，探究城市路网交通态势建模的时空数据挖掘方法。按照“时空特征提取— 因果关系挖掘—频繁模式识别—未来状态预测”的数据挖掘逻辑主线，围绕如何考 虑时空多维度特征提取同质的交通状态变化模式、如何构建路网交通状态因果关 系模型、如何识别频繁交通拥堵状态时空传播模式、如何预测路网交通状态四个问
3

第 1 章 绪论
题展开研究，具体如下： （1）考虑时空多维度特征的同质交通状态变化模式提取
路网交通状态具有很强的时变特性，并在空间路网中呈异质性的分布特征。深 入挖掘交通状态的时空特征，对于改进交通管理控制策略，缓解城市交通拥堵具有 重要意义。大量检测器持续地采集高频度的原始数据，导致海量的交通数据积累， 并没有及时得以充分地利用。为了降低路网交通流数据的冗余性，可采用数据降维 技术提取路网交通状态的基本时空特征，实现对数据的有效压缩。本研究提供了一 种新的组合方法来发现同质的时空交通流状态模式，并将大规模路网划分为具有 相似拥堵水平的子路网。利用张量分解算法提取交通状态的短期时间变化趋势、长 期逐日变化规律以及空间上的分布特征，为时空谱聚类算法提供低维的特征空间。 本研究提供了一个从宏观路网的角度深入挖掘城市交通状态时空特征的方法。每 个子路网具备相似的时空交通状态模式，模式之间的时空特性异质性较强。采用宏 观路网交通流基本关系来描述每个子路网的交通状态，对于基于宏观基本图的路 网交通估计与控制研究非常有意义。 （2）基于传递熵算法的交通状态时空因果关系挖掘
在大数据时代虽然可以通过直接挖掘事物之间相关性的方式，做出准确可靠 的决策，但是无法明确事情发生的前后因果关系，海量的数据信息也没有得以充分 地挖掘和利用。在数据挖掘和知识发现领域，因果关系分析能够一定程度上弥补相 关性研究的不足，识别事情发生的根源，能够挖掘出更多更有价值的知识。
城市交通大数据领域的研究主要偏向于相关性，目前因果关系挖掘未得到充 分的应用。路网中不同路段的交通状态不仅存在时空相关性，而且具有因果关联性。 交通大数据挖掘不仅要关注变量之间的相关性，也要研究其中的因果性。本研究基 于大量的交通流时间序列数据，针对路网时空交通状态建立因果关系挖掘模型，采 用传递熵算法量化不同路段交通时空状态的因果关联性和相互作用，能表征交通 变量之间信息传递的时序动态性，有助于识别对外影响作用大的关键路段，发现不 合理的路网设计。针对识别的关键路段采取科学的交通管控措施，或优化路网结构 设计，可以达到提高交通运行效率的目的。 （3）基于时空因果关系的交通拥堵状态频繁传播模式识别
随着机动车保有量的持续增长，常发性拥堵的发生频率逐步上升，影响范围逐 渐扩大，降低城市交通状态的运行效率。交通拥堵状态传播可视为局部拥堵状态沿 相邻路段扩散到更大空间范围的过程。拥堵若未得到有效疏解，可能会演化为大范 围区域的交通瘫痪。目前大部分拥堵传播研究主要基于传统的交通流相关理论，采 用计算机仿真的方法，呈现单条路段或者交通流汇合处的排队激波等微观层面拥
4

第 1 章 绪论
堵形成及消散现象，但是无法准确地对宏观路网层面的交通拥堵传播和消散进行 建模。
本研究旨在提取多天频繁出现的交通拥堵传播模式，呈现交通拥堵从瓶颈路 段向空间邻近路段传播的过程，提出了一个数据驱动下的路网交通拥堵状态传播 模式方法。基于时空因果关系挖掘建立交通拥堵传播频繁模式识别模型，从历史数 据中识别频繁发生的拥堵传播路径，识别常发性拥堵传播模式，发现不合理的路网 设计。从海量的交通流数据里挖掘拥堵沿道路网路的传播规律，对于利用交通大数 据辅助城市治堵工作有非常重要意义。一方面，可以对容易引发拥堵的路段，提前 采取管控措施，预防拥堵的形成和传播；另一方面，拥堵一旦发生，提取的频繁传 播模式能够协助交通管理部门及时辨识并遏制拥堵传播和扩散。此外，该研究也能 为预测拥堵传播路径提供理论基础。 （4）考虑时空信息的城市路网交通状态预测
短时交通流预测是智能交通系统中最为动态和经典的研究，在先进出行者系 统和先进交通管理系统起着关键的作用，主要可分为基于统计方法和机器学习算 法的短时交通流预测模型。前者能充分利用历史单变量时间序列数据之间显著的 时间依赖关系，通常要提前设定模型结构，从历史数据中估计模型参数，可解释性 较强。后者则是学习模型响应和预报器之间的关系，能够捕获变量之间的非线性特 征，预测精度较高，但输入变量对于模型的预测结果影响难以解释。
为了能够挖掘交通流复杂的非线性特征和预测模型变量的重要程度，本研究 采用梯度提升决策树（GBDT）的方法，选择历史上下游交通流量作为模型的特征 变量，预测目标路段的未来状态。对于一个大范围城市路网交通系统而言，交通状 态的变化非常复杂，不同的路段之间交通状态存在较强的时空相关性，只考虑单一 路段或者邻接路段影响的预测模型存在一定的局限性。本文在 GBDT 算法的基础 上，引入时空变量筛选的特征提取环节，构造基于因果关系强度的时空变量选择方 法（STVS-GBDT），能够从海量的路网交通流时间序列数据中挖掘出能显著影响目 标路段交通状态的时空关联特征，有效压缩预测模型的输入变量维度，保证预测精 度的同时，也能显著降低模型复杂度，提高预测效率。
基于对以上四个关键问题的深入研究，本文的研究意义包括： 1）与传统的机理模型相比，本研究从数据驱动的角度，深入挖掘海量的交通 流时空数据中潜在的交通演变规律和特征，为交通时空态势分析、因果关系挖掘、 交通拥堵状态传播和交通流预测提供新的理论研究框架。本研究避免了模型驱动 研究中存在的假设理想化、复杂参数标定困难、实际信息利用不充分等问题，提高 了基础模型的适用性。
5

第 1 章 绪论
2）将统计机器学习、数据挖掘、信息论的方法应用于交通领域，致力于“数 据科学+智能交通”交叉学科的研究，为交通时空数据的分析与挖掘提出了一个系 统性的研究思路，推动了大数据驱动下智能交通技术的发展。促进了交通态势建模 与数据挖掘技术研究的交叉融合，符合未来智能交通发展方向，也符合大数据服务 城市交通的发展需求。
3）创新性地提出了四个关键的数据挖掘技术，可应用于智能交通管理系统、 出行信息管理系统、车联网等领域，提高路网交通态势的智能化管理水平。一方面， 从历史数据中挖掘的交通时空变化规律和拥堵传播模式有助于识别路网上的瓶颈 路段，能够为优化路网设计提供决策支撑，同时也可以辅助交通诱导和控制，以提 高路网的交通承载力和运行效率；另一方面，可以提供准确可靠的未来交通状态信 息，以及频繁的拥堵传播路径，有助于公众选择合理的出行路径及方式，提前做好 出行规划。
1.3 国内外研究现状
1.3.1 交通状态时空变化规律研究
基于时间序列相似性的聚类方法被广泛应用于时空交通数据挖掘领域中，对 交通时空状态进行分类，发现属于一种数据降维技术，能够挖掘海量的交通数据背 后隐含的交通变化相似规律和结构特征，揭示交通流状态在时空维度上分布的异 质性，提取同质的交通状态变化模式。通常此类研究是按时间序列的相似性，将多 个时间序列数据划分为若干个子集序列，每个子集包含的时间序列具备相似的变 化趋势，可定义为“模式”。可以分为针对同一路段不同日期和不同路段不同日期 的交通状态进行分类，前者主要用于识别路段的相似时间序列状态模式；后者属于 考虑空间多条路段，用于识别路网层面相似的交通时空状态变化模式。Jiang 等[8] 采用模糊聚类的方法对单条路段的交通状态进行分类，能够动态识别路段的交通 状态。Weijermars 等[9]在不考虑路网空间分布模式的情况下，从交通流数据中提取 交通模式，利用层次聚类技术对单个检测器每日异质的交通状态时间变化特征进 行分析。Wen 等[10]对交通运行指数（TPI）时间序列进行聚类，识别出城市典型的 拥堵模式，结合日期、运输需求管理政策、节假日、天气条件等因素，验证了 TPI 模式曲线的存在。
随着交通数据的大范围采集，同时考虑交通状态在时间和空间维度上分布特 征的聚类研究逐渐兴起。Pascale 等[11]提出了一种基于谱聚类的时空聚类框架，提 取了不同的时空交通模式，每个模式对应的宏观基本图差异性明显，证实了路网交
6

第 1 章 绪论
通状态分布的异质性。Anbaroglu 等[12]等采用时空聚类的方法，识别城市道路网络 上的非经常性交通拥挤。Cheng 等[13]采用模糊 c 均值聚类对城市快速路的交通状 态进行分类，改进了模糊隶属度函数，并对样本进行加权处理，提高了聚类效果。 杨艳芳[14]提出一种基于复杂网络和 k-means 的聚类算法，识别路网的社区结构，提 取路网空间上的交通状态互相关模式。卢守峰[15]改进 K 均值聚类算法，考虑路网 连接性，对路网划分进行划分。但若将长期采集的高维度交通流时间序列数据直接 输入，会给聚类模型带来“维数灾难”，数据维数的增加会显著影响聚类技术所依 赖的距离或相似性度量方法的准确性[16]。因此这类方法不适用于处理长期大规模 路网范围下的交通流时空状态变化模式提取问题。
基于时空相似性的同质交通状态变化规律研究在缺失数据填充、交通流状态 预测及宏观路网交通控制等领域应用广泛。从历史数据中提取的路网同质交通流 状态时空模式有助于提高缺失数据补偿和交通状态预测的效果。Stutz 等[17]采用模 糊聚类的方法对交通流阻滞状态进行聚类，基于聚类得到的模式预测长期的交通 流状态。Jeneliu 等[18]把相似交通状态的路段聚类在一起，每类路段共享相同的预 测函数，有效降低了模型训练成本。Zhang 等[19]对快速路每日交通速度序列进行聚 类，假设交通模式在自然和历史数据库中反复出现，获取当前的状态，从历史记录 中提取相似的交通模式，可以通过将当前数据与历史数据进行匹配来预测未来的 交通状态，采用相似时空交通模式匹配的交通状态预测方法，比参数方法具有更大 的灵活性，容易迁移到预测其他位置的交通状态。
除了采用聚类方法探究交通状态时空变化规律，Gao 等[20]提出了一种新的 RA 测量方法，研究了路网交通状态的空间异质性和单一路段交通状态的时间异质性， 而不是路网交通状态的时空异质性。邹海翔等[21]从空间依赖性和异质性角度，在 宏观层面上研究路网交通状态和空间形态之间的关系，挖掘交通状态的空间分布 特征。Hsu 等[22]提出一个分层高斯混合模型框架，采用相变方法识别不同的交通流 模式和动态转化行为，每种模式代表对一种特殊动态交通行为的解释。
1.3.2 交通状态时空特征提取方法
随着数据驱动智能交通系统的快速发展，持续地收集并积累海量详细的原始 数据，带来了“数据窒息”（Data Asphyxiation）问题[23]。为了降低交通流数据的冗 余性，需要从原始数据中提取交通状态的基本时空特征，构造出一个更低维更紧致 的空间。一方面有助于深入挖掘路网交通流的时空特征，有助于交通管理部门改进 交通管理控制策略，进而缓解城市交通拥堵[24, 25]；另一方面，交通状态时空特征提 取是路网交通模式识别、交通流预测等问题的一个非常关键的环节，能够为模型提
7

第 1 章 绪论
供有效的特征输入，降低复杂度。 基于子空间分解的数据降维技术是一种有效的特征提取方法，是当前交通时
空数据挖掘领域的一个热点问题。常用的方法包括主成分分析法、矩阵分解法等。 Ren[26]等使用主成分分析法（PCA）为网络级交通流模式识别提取主要特征。Han 等[27, 28]提取时空交通模式，利用保局域性非负矩阵分解（NMF）进行长期交通状 态预测。Mitrovic 等[29]提出一个基于列的奇异值分解方法（SVD），对大范围的路 网交通数据进行降维和压缩，显著降低了预测模型的计算成本。Xu 等[30]采用局部 敏感判别分析方法（LSDA）提取了交通网络的时空特征，有效降低了矩阵的维度， 揭示了交通数据中潜在的模式。Shang 等[31]使用奇异谱分析（SSA）的方法过滤了 原始交通流数据的主要成分，保留了主要的时空数据特征，属于预测模型的一个预 处理环节。
以上这些方法是基于传统的二维矩阵形式识别两维属性之间的相互关系，但 不能挖掘更高维度上数据潜在的规律性和相关性[32]。使用矩阵不能充分表征路网 水平上的各路段之间交通流状态时空相关性，需要采用适当的数据形式表示[33]。 为了提取多维特征，“张量”是一维向量和二维矩阵的高阶形式扩展，近年来在交 通工程领域的应用开始兴起，例如缺失数据填充[33-35]，交通流预测[36]和交通数据 压缩[37]等等。
张 量 分 解 能 够 提 取 多 维 度 变 化 特 征 ， 最 常 用 的 方 法 是 Tucker 分 解 和 CANDECOMP/PARAFAC (CP)分解。大多数研究应用 Tucker 分解，将一个张量分 解成一个核张量乘以每个模上的矩阵的形式[38]。 Wang 等[39]通过正则化非负 Tucker 分解，从时变的交通网络中发现城市时空结构。Chen 等[35]提出了一个 Tucker 张量分解的框架，采用奇异值分解的方法提取每个维度潜在的特征，从历史数据中 提取时空交通模式，恢复缺失的交通数据。Dauwels 等[40]建立基于 Tucker 分解的 多路段交通状况预测模型。Sun 等[41]提出了一个概率 Tucker 张量分解框架，从智 能卡刷卡数据中提取公共交通出行多模式移动性特征。Han 等[42]基于交通仿真数 据，采用 Tucker 分解描述城市路网时空动态特征。邴其春[43]采用层次 Tucker 张量 分解算法，充分考虑交通流的相关性，对城市快速路交通流缺失数据进行填充，实 现较好的填充效果。张量分解用于交通时空数据挖掘的好处：相比于矩阵，张量可 以描述了更丰富的代数结构，编码更多的信息。张量分解可以在无监督条件下挖掘 内部潜在的结构化模式[44]。即使是在少量观测数据的条件下，张量分解仍然可以 提取有效的特征模式，因此适用于处理实际数值缺失的交通数据。
8

第 1 章 绪论
1.3.3 交通时空状态因果关系挖掘
在大数据时代虽然可以通过直接挖掘事物之间相关性的方式，做出准确可靠 的决策，例如经典的“啤酒与尿布”的例子，但是无法明确事情发生的前后因果关 系，海量的数据信息并没有得以充分地挖掘和利用。在数据挖掘和知识发现领域， 因果关系分析能够弥补相关性研究的不足，识别事情发生的根源，能够挖掘出更多 更有价值的知识。在空气污染[45, 46]、气候[47]等领域已经开始出现时空数据因果关 系挖掘的研究，在城市交通大数据领域的研究主要偏向于相关性，因果关系挖掘未 得到充分的应用。路网中不同路段的交通状态不仅存在时空相关性，而且具有因果 关联性，例如某条路段的拥堵导致后续一定空间范围内其他拥堵事件的发生。交通 大数据挖掘研究不仅要关注变量之间的相关性，也要进一步深入挖掘其中的因果 关系。
目前在交通领域中因果关系挖掘研究主要采用简单的先验知识法，依据交通 拥堵或异常状态发生的先后顺序定义因果关系，或者采用贝叶斯网络数据驱动的 方式进行因果关系建模。Liu 等[48]通过设定在空间上交通异常事件的终止节点是另 外一个交通异常事件的起始节点，且两个事件在时间上是连续发生的约束来定义 交通状态时空因果关系（Spatio-temporal Causality）。类似地，Kapoor 等[49] 对道路 交叉口拥挤状态的因果关系进行建模，采用简单的拥堵事件发生时间上的先后顺 序和空间位置上的邻近关系来定义时空因果关系，研究拥堵如何从路网中的一个 点向各个方向传播，并预测未来可能的传播模式。Chu 等[50]采用动态贝叶斯网络对 时变的交通状态因果关系进行建模。Queen 等[51]提出了一个多元动态贝叶斯网络 模型，保留交通流时间序列的条件独立性和因果关系，通过设置外部干预，识别贝 叶斯网络中变量之间的因果关系，以及动态贝叶斯网络中时间序列之间的滞后因 果关系。
以上关于交通时空状态因果关系挖掘模型由于定义因果关系的方式较为简单， 或者量化因果关系的算法复杂度高，不能充分挖掘大范围时空特征变量之间潜在 的因果关系强弱程度以及复杂的非线性特征，不适合大规模的路网交通状态时空 因果分析。近年来开始有学者研究基于路网多变量交通流时间序列分析的因果关 系挖掘模型。例如，Granger[52]于 1969 年提出的格兰杰因果检验（Granger causality test），是一个非常有效的识别潜在因果关系的方法，在时间序列因果关系挖掘领域 得到广泛的应用。Granger 的核心原理是：如果使用变量 X 和 Y 的历史信息预测 X 未来时刻状态的模型效果优于比仅使用 X 历史信息的预测模型，即加入一个变 量 Y 能够显著地提高另一个变量 X 的预测精度，则可认为变量 Y 是变量 X 的原 因（Causal）。Li 等[53]采用 Granger 因果关系定义了交通流时间序列数据之间潜在
9

第 1 章 绪论
的因果关系，生成高度依赖的时间序列，挖掘重要的因果关系，基于因果依赖关系 图分析了道路网络结构和交通流量时间序列之间的相关性，并在此基础之上建立 更准确的预测模型。值得注意的是 Granger 因果关系模型需要假设两个变量之间满 足线性关系，不适用于分析非平稳非线性系统的因果关系，因此该方法对于表征长 时间大范围交通时空特征变量之间的因果关系存在一些不足。
1.3.4 交通拥堵状态传播模型研究
交通拥堵现象非常普遍，通常是由交通需求大于道路通行能力造成的。随着交 通需求不断增大，路网通行能力无法满足需求，路网拥堵瓶颈出现。从空间分布的 角度，交通拥堵可以分为点拥堵、线拥堵和面拥堵[54]。韦伟[55]认为交通拥堵传播 是拥堵状态沿着路网拓扑结构扩散的空间过程。当某条路段发生拥堵时，邻近路段 发生拥堵的概率高于更远的路段，堵塞状态通过向邻近道路蔓延而逐渐扩大[56]。
目前已经有很多研究分析路网上瓶颈处的交通流状态。Newell 等[57]提出某条 车道上缓慢行驶的车辆引起后方车辆排队，形成移动瓶颈 （Moving Bottleneck）。 Gazis 等[58]认为当车辆在交通堵塞中缓慢前进，但前方没有障碍，会有幽灵堵车 （Phantom Bottleneck）的现象发生。高自友等[59]认为不断增大的交通需求能够导 致拥堵瓶颈的产生。形成交通拥堵的原因是多方面的，Wright 等[60]总结了交通拥 堵发生的三类原因，包括暂时性的交通障碍，路网本身持久性的拥堵瓶颈，以及路 网某部分交通需求的随机波动。可以按交通拥堵发生的频率将其划分为常发性拥 堵和偶发性拥堵，前者是由交通需求量周期性过大引起的，导致交通流量超过道路 承载力, 比如早晚高峰期拥堵；后者是由突发性的交通管制或事故引起的，导致 路段通行能力骤降[61]。交通拥堵的传播过程与“多米诺骨牌现象”类似，如果对交 通拥堵传播进行控制，能有效预防路网交通堵塞的发生[62]。
城市道路网络系统的网络拓扑结构和交通运行规律非常复杂，可视为复杂网 络系统，具备复杂的动力学特性，因此近年来许多学者基于复杂网络的性质对其进 行建模，深入分析路网交通的运行机理。吴建军[63]从复杂网络的角度，研究了道路 交通网络的级联失效现象，认为关键路口或路段的堵塞，可能会造成拥堵连锁反应， 导致大范围甚至整个路网的交通瘫痪。李树斌等[64]从交通动力学行为的角度，研 究交通网络拓扑结构对交通拥堵形成和传播规律的影响。汪玲等[65]基于复杂网络 理论提出网络异质性指标，研究异质性对交通拥堵的影响。
交通拥堵传播研究方法可以分为两大类：计算机模拟法和数据驱动法。目前大 部分拥堵传播研究主要基于传统的交通流相关理论，采用计算机模拟的方法，呈现 单条路段或者交通流汇合处的排队激波等微观的拥堵形成及消散现象，但是无法
10

第 1 章 绪论
准确地对大规模路网交通拥堵传播和消散进行建模[59]。很多学者采用元胞传输模 型[66]研究拥堵的形成和传播过程。计算机仿真方法被广泛应用的原因是不需要采 集大量的观测值，迁移能力较强，可以对拥堵结果进行敏感性分析，评价交通控制 策略对于交通状态的影响。Qi 等[62]采用宏观仿真的方法分析局部交通堵塞现象的 形成和传播，入口的位置、相位序列、信号协同控制等因素会影响拥堵的传播。 Long 等[67]采用元胞传输模型，搭建双向矩形网格网络，在微观层面上模拟交通堵 塞的形成和消散，分析了模型参数对于交通堵塞范围和拥堵延误的影响，研究不同 交通需求条件下路段的通行能力和路网瓶颈分布。Roberg 等[68]针对城市中心区域 建立仿真模型，研究不同网络条件下的拥堵形成和消散过程，分析堵塞对于路网交 通的影响。Li 等[69]采用改进的中观交通流模型，研究不同交通需求水平下交通拥 堵在双向网格网络上的传播。
总体上，计算机模拟的方法能够评价控制策略对于缓解拥堵的影响，可以开展 深入的敏感性分析研究，但通常依赖于底层模型。有限的计算能力和复杂的底层模 型导致计算机模拟方法的研究对象主要是规范化的小范围路网，普适性较弱。随着 交通信息感知和传输技术的提高，大范围长时间的交通流时空数据累积促进了数 据驱动下的交通拥堵建模研究快速发展。宏观路网层面上的交通拥堵传播模式识 别是交通数据挖掘和知识发现领域一个新兴的研究热点问题。近年来一些学者提 出了基于时空数据挖掘的交通拥堵传播研究方法，从历史数据中识别频繁出现的 拥堵传播模式。梁林林等[70]采用关联规则挖掘的方法，分析上海市快速路断面之 间交通拥堵状态的时空关联特征和网络特征。Inoue 等[71]针对工作日和周末提取了 交通拥堵模式，解释了拥堵传播过程，展示了拥堵范围扩大和收缩现象，从数据驱 动的角度刻画了拥堵的产生、扩散和消散过程。Chawla 等[72]提出了一个推测道路 交通拥堵根源的优化挖掘算法框架，但没有识别拥堵传播的模式。Xiong 等[73]在从 历史数据中提取拥堵传播模式的研究基础上，预测未来的拥堵传播模式。
实际上，交通拥堵状态不仅在时间和空间维度上具备时空相关性，而且存在一 定的因果关联性。拥堵始发的路段可以认为是拥堵原发点，是后续拥堵发生路段的 原因路段。目前关于拥堵传播规律挖掘和交通拥堵事件之间因果相互关系的研究 比较缺乏[48, 50]。已有的交通因果关系挖掘研究以子区域为基本的研究对象，构建 的图模型中每条边代表区域与区域之间是否有交通流量[48, 74]。但是区域与区域之 间可能对应有多条路径，每条路径会包含多条路段，然而现实中的交通流是基于路 段的，而不是基于区域的。例如，从一个区域到附近的区域可能有多条路径，每条 路径有不同的交通路段，仅通过判断区域之间的交通异常状态难以确定具体哪条 路径及路段上发生拥堵[75]，因此基于子区域为数据基本单元的研究具有较大的局
11

第 1 章 绪论
限性。此外，一些学者采用动态贝叶斯网络提取交通拥堵状态传播模式。Chu 等[50] 提出了一个随时间变化的因果关系结构，基于动态贝叶斯网络模型，揭示了环路系 统时变区域宏观结构的演化过程和道路交叉口时变的依赖性关系，能够识别节点 对之间的依赖结构，而不是一定时期内重复出现的传播模式。Nguyen [75]利用路网 上拥堵状态发生的时间和空间信息，创建拥堵因果树模型，基于动态贝叶斯网络估 计拥堵传播的概率，能够识别时空拥堵的路段和数据流中的因果关系。虽然动态贝 叶斯网络可以提取路网交通状态潜在的因果关系结构，但是需要基于大量的历史 数据学习对应的模型参数，计算效率较低，对于大规模路网而言，计算较为复杂。
1.3.5 短时交通流状态预测研究
短时交通流预测是智能交通系统中最为动态和经典的研究，基于历史数据估 计邻近时间内的交通状态，是实现自适应控制的研究基础，对于路网层面的交通管 理和路径引导具有至关重要的意义，也是智能交通应用研究的热点。预测的交通信 息可以帮助出行者在出发前阶段制定更合适的出行计划，或者在途中重新安排行 程[76]。精确的短时交通流预测是实时路径诱导重要的第一步[77]，在先进出行者系 统（ATIS）和先进交通管理系统（ATMS）起着关键的作用[78]。随着智能计算的发 展，交通状态预测模型从简单的线性方法，逐渐转变为复杂的机器学习非参数方法。 交通时空状态信息日渐丰富促进了预测模型从仅考虑简单的历史时间序列数据， 发展到同时考虑时间和空间联合信息的影响，预测精度得以进一步提升。
Vlahogianni 长期致力于交通状态预测研究，采用统计和机器学习的方法，基 于交通流时空信息对交通状态进行预测[79, 80]，她发表了交通信息预测领域具有代 表性的两篇综述论文，分别是： 2004 年综述论文，从建模过程、模型输出、应用 范围三个方面系统地总结了预测模型的发展[81]；2014 年综述论文，总结了 2004 年 以后的预测研究，从预测算法、预测范围、数据质量、可解释性、时空依赖性、人 工智能算法的应用等方面提出了预测领域面临的十大挑战和发展趋势[82]。
基于统计方法的传统短时交通流预测模型，例如 ARIMA，卡尔曼滤波方法， 充分利用历史单变量时间序列数据之间显著的时间依赖关系。此类方法通常提前 设定模型结构，从历史数据中估计模型参数，可解释性较强，但是预测精度容易受 不平稳的交通状态影响，如高峰期，不适合处理包含结构化和非结构化数据的数据 集[83]。非平稳性和非线性是交通变量的基本特性[84]。统计学方法通常在处理交通 流数据时会失效，因为统计学方法通常是基于线性结构，对于处理大数据问题，容 易陷入维度灾难[23]。Smith 等[85]采用 ARIMA 模型预测未来时间的交通状态，在时 间维度上可以反映历史时刻的交通状态对未来时刻状态的影响作用，即时间维度
12

第 1 章 绪论
上的因果关系，具备较强的可解释性。Xie 等[86]采用小波卡尔曼滤波模型预测短时 交通流量，适合处理噪声较大的非平稳交通流时间序列预测。
基于机器学习的非参数方法被广泛用于短时交通流预测，能够挖掘变量之间 的非线性特征，预测精度较高，包括反向传播神经网络算法(BPNN)[87, 88]，支持向 量机算法(SVM)[89, 90]，K 近邻算法 (KNN)[91]。这些方法属于有监督学习方法，需 要预先准备目标变量的取值，重点学习模型响应和预报器之间的关系[92]，能够从 海量数据中有效地提取潜在的信息，实现较好的预测效果，但缺少可解释性。为了 提升非参数模型的预测效果及可靠性，有学者提出基于集成学习框架的预测模型， 将简单的基模型按一定的集成规则进行组合，得到更为精确且稳健的预测结果。 Zhang 等[93]提出了一个基于梯度提升框架的集成学习算法，基本模型是树模型，预 测路段的旅行时间，取得较高的预测精度。Van 等[94]提出了基于贝叶斯推断的集成 学习预测框架，基模型是神经网络模型，实现了较高的预测精度，并实现了对预测 结果置信区间的精确估计。许岩岩[95]分别采用贝叶斯模型平均和 Bagging 的集成 学习框架，把不同时间滞后的基模型组合在一起，提高模型的预测效果。
以往很多的研究是针对指定点的交通状态变量预测，仅考虑其时间维度上历 史交通信息的影响，忽略了空间维度特征。实际上，交通状态变量不仅与时间维度 交通状态因素密切相关，而且受空间上其他位置的交通状态影响。考虑时空交通联 合信息的影响是交通流预测领域的一个主要发展方向。部分学者考虑上下游邻近 交通状态的影响，认为目标路段的交通状态与其上下游交谈状态密切相关，且上下 游交通状态对目标点交通状况的影响是不对称的。Williams[96]构建多变量交通流预 测模型, 通过把上游交通流序列作为 ARIMA 传递函数的输入。Jeong 等[97]考虑上 下游交通状态的时空关系，采用支持向量回归（SVR）模型构建短时交通流预测模 型。Chandra 等[83]采用交叉相关性分析方法分析当前点的交通速度和上下游位置过 去的交通状态之间的关系，加入邻近地点交通变量的信息可以提高目标点的交通 预测精度。Zeng 等[98]采用递归神经网络（RNN）模型，探索上下游交通状态对当 前路段交通状态预测的影响，研究结果表明下游路段和当前路段的历史信息有助 于提高目标路段旅行时间的预测精度。
随着智能计算方法的快速发展，以及交通流时间序列数据日渐丰富，从 2014 年开始来以深度神经网络学习为代表的前沿机器学习算法，能够充分考虑路网交 通状态的时空相关性，挖掘复杂的路网交通流状态时空变化特征，对路网范围的交 通流量进行预测。Huang 等[99]建立深度信念网络（DBN），采用无监督的方式提取 特征，基于顶端的多任务回归层进行有监督预测。Lv 等[100]构建了一个基于堆叠自 编码的深度学习预测方法，从交通数据中提取潜在的非线性时空相关性，采用贪婪
13

第 1 章 绪论
分层无监督学习算法对深度网络进行预训练。Ma 等[101]采用长短期记忆神经网络 （LSTM）算法预测路段交通流速度，能够提取时间维度上的长期依赖性。Cheng 等[102]构建多任务学习的不同时间范围预测模型，分别针对上游模块和下游模块使 用卷积和长短期神经网络提取目标路段上游和下游的交通状态时空特征。Wu 等[103] 采用卷积神经网络（CNN）和循环神经网络（RNN）的组合模型框架，预测快速路 主干道的短时交通流，道路被分割为多条路段，可视为一个向量，作为一维 CNN 模型的输入，提取路段的空间特征，使用 RNN 挖掘时间上的特征。以上基于深度 学习算法的预测模型，属于端到端的方法，能够获得较好的预测精度。虽然深度学 习方法不需要人工设计特征提取方法，能够通过层层网络从最基本的特征组合对 应的数据中自动地抽象为更高级的特征，但为了学习交通数据中潜在的时空特征， 神经网络的结构设计复杂，模型训练间长，调节参数工作量大，而且需要消耗大量 的计算资源。
为了权衡预测模型的精度和计算效率，可以在时空范围内选择合适的交通变量， 降低特征变量的维度和模型的复杂度，建立考虑空间多路段影响的短时交通状态 预测模型。但仅依据一些简单的先验知识对预测模型的输入变量进行筛选，可能无 法实现较好的预测效果。交通流的时空结构特征不应仅限于受道路物理网络上连 通邻接路段的影响，还应考虑与远距离路段交通状态的时空关联关系。由于路网交 通态势演化的复杂性，距离目标路段更远的路段可能比距离更近的路段对预测结 果的影响作用更大。准确提取路网交通状态时空结构特征，挖掘时空关联关系，对 于提高预测模型的精度和稳健性起着关键的作用。因此，数据驱动的特征选择和提 取方法在交通流预测问题上起着非常关键的作用。
Pavlyuk[104]全面系统地总结了在时空交通信息预测领域常用的特征选择和提 取方法，可以分为五类：外生特征过滤法、内生特征过滤法，包装特征选择法、嵌 入特征选择法和维度降低方法。 蒋士正等[105]采用基于 Lasso 的变量选择方法，从 复杂的路网中选择与当前断面交通状态相关性高的其他多断面，提出了一个 “Lasso-神经网络”组合预测模型，实现较好的预测精度和效率。商强等[106]提出了 一个基于随机森林算法选择影响交通事件检测的重要变量，减低了模型的输入维 度，提高了检测效果。Xu 等[107]基于多元自适应回归样条（MARS）模型，从高维 的时空变量中选择对预测贡献大的变量，基于选择的变量数据集采用 SVR 模型进 行训练。以上研究表明时空特征变量的选择能够提高交通信息的预测效果。
为了更加科学地选择预测模型的输入变量，因果关系挖掘逐渐在交通流预测领 域应用起来。Spirtes 等[108]将因果关系挖掘与回归预测模型结合起来，提高了预测 模型的效果。Hsu 等[22]为了描述这些检测器位置的重要性，计算不同检测器采集的
14

第 1 章 绪论
交通流数据的信息熵。Li 等[53]指出潜在的因果依赖性和时间序列的复杂性是可靠 交通预测的障碍，采用因果关系挖掘的方法，提取交通流时间序列数据的因果关系， 建立了一个适用于大数据条件下考虑多传感器交通流状态的“拉索-格兰杰因果” 回归模型，降低了数据的冗余性，实现较好的预测效果。
此外，目前短期交通流预测领域中大多数研究选择特定区域一定时间内特定路 段或者路网的交通流时空数据集，且对比方法不统一，因此难以比较不同预测方法 的准确性和效率。未来该领域可以尝试建立一个固定统一的数据集和对比方法，用 以验证每个新方法在预测领域的有效性。
1.4 研究内容与技术路线
本文基于路网交通状态数据的时空特性，创新地提出了一个基于时空数据挖 掘的城市路网宏观交通态势分析及预测的研究框架，实现对交通时空状态宏观特 征的挖掘与解析。论文的技术路线和架构分别如图 1.4 和图 1.5 所示。
第 1 章为绪论。在城市交通拥堵日益严重和交通时空数据大量采集的背景下， 针对传统机理驱动路网交通模型研究的不足，提出了基于时空数据挖掘的路网交 通态势分析及预测应用的研究框架。从交通状态时空变化规律、时空特征提取方法、 时空因果关系挖掘、拥堵状态时空传播以及短时交通流预测五个方面对国内外的 研究进展进行论述，并提出了本文的主要研究内容和技术路线。
第 2 章为城市路网交通时空数据特征及处理技术。详细分析了交通流数据的 时空特征，并介绍了本文的路网交通数据集。从异常数据检测、数据融合、数据修 复、数据滤波等方面解释了交通时空数据的预处理过程，并给出具体的处理实例。
第 3 章为考虑时空多维度特征的同质交通状态变化模式提取模型。提出了一 个同质交通状态模式识别方法，将城市网络划分为若干个具有相似交通时空状态 变化的子网络。非负张量分解算法提供一个从宏观层面多维度挖掘网络级交通流 状态特征的视角，识别潜在的交通流时空演变规律。使用空间距离系数修正谱聚类 算法的高斯相似图，能够显著提升子路网的空间邻近程度。子图网对应的宏观交通 流关系图的显著差异性验证了交通时空模式彼此之间的异质性。对于深入挖掘路 网交通流复杂的时空特征，对缓解交通拥堵、预测未来交通状态及制定交通控制策 略具有重要意义。
第 4 章为基于传递熵算法的交通状态时空因果关系挖掘模型。采用传递熵的 因果关系分析方法，针对路网时空交通状态建立因果关系挖掘模型。首先利用滑动 窗口技术和高斯核密度估计方法来构建传递熵矩阵，量化不同路段交通时空状态 的因果关联性和相互作用，能表征交通变量之间信息传递的时序动态性。其次，基
15

第 1 章 绪论
于因果关联系数矩阵，提出被影响系数和影响系数指标，定量地分析不同时段下任 意一条路段对路网上其他路段交通状态的影响程度和被影响程度。最后，采用因果 显著性检验方法，建立具有显著因果关系的动态时空因果关系图。提出输入度和输 出度指标，识别不合理的路网设计及关键路段。
第 5 章为基于时空因果关系的交通拥堵状态频繁传播模式识别模型。首先， 从大量的交通状态时间序列数据中识别不同路段在不同时段的交通拥堵事件。其 次，在第 4 章的因果关系挖掘研究的基础上，判断拥堵事件之间是否具备因果关 联关系。基于提取的交通拥堵事件和交通状态因果关系强度，以及考虑拥堵状态发 生的时间连续性和空间连通性，构建路网交通拥堵状态时空传播图。最后，采用频 繁子图挖掘的方法，挖掘相邻路段拥堵状态之间的强关联规则，提取潜在的频繁交 通拥堵状态传播模式和关联模式。
第 6 章为考虑时空信息的城市路网交通状态预测模型。选择历史上下游交通 流量作为预测模型的特征变量，基于目标路段及其邻接路段当前和历史时刻的数 据，建立考虑上下游时空交通信息的梯度提升决策树短时预测模型。在第 3 章路 网划分研究和第 4 章因果挖掘研究的基础上，引入基于因果关联性特征提取的变 量筛选法，定义变量的贡献度，构造基于传递熵变量选择的路网交通状态预测模型， 从大量的交通流时间序列数据中挖掘出能显著影响目标路段交通状态的时空特征 变量，能够有效压缩预测模型的特征变量维度，显著降低模型复杂度，提高预测效 率和精确性。
16

第 1 章 绪论
图1.4 论文技术路线 17

第 1 章 绪论
图1.5 论文架构图 18

第 2 章 城市路网交通时空数据特征及处理技术
第 2 章 城市路网交通时空数据特征及处理技术

2.1 交通数据时空特性分析

2.1.1 时间维特性
交通流时间序列建模广泛用于交通流预测、缺失交通数据填充、交通数据压缩、 异常交通数据检测等问题[109]。本节从周期性、趋势性以及时间自相关性三方面分 析路网交通流的时间维特性。
（1）周期性 虽然单个出行决策难以预测，甚至有时可能会出现不理智的选择[110]，从宏观 的角度来看，人们通常遵循强烈重复性活动模式，导致明显的出行规律，交通流呈 现非常明显的重复规律性，即周期性。由于早晚高峰频发性交通拥堵，工作日之间 的交通状态相似，因此会存在日变周期性。工作日和周末的交通状态差异较大，周 末的拥堵状况一般会得到缓解，交通状态呈现以一周为周期的规律性波动。 （2）趋势性 交通状态变化具有明显的周期性，可以从多天的时间序列数据中提取交通状 态的历史变化趋势。交通流的趋势性分为长期趋势性和短期趋势性，前者可以反映 交通流时间序列的日相似性，后者则代表交通流序列短暂性的突变波动趋势[109]。 苏晓楠[111]采用趋势建模方法把传感器采集的交通流数据分为交通流长期趋势部 分和波动部分。通常以天为单位，提取交通流的日间长期趋势，能反映交通状态随 时间变化的主要规律。 （3）时间自相关性 时间自相关性系数可以用来分析交通状态时间序列中任意两个不同时刻的交
通状态相关程度。 k 阶时间自相关系数代表时间序列 X 与 k 个单位时间滞后的时
间序列之间的相关程度，计算公式为：

C=

n−k
 (xi − xi )(xi+k − xi+k )
i =1

n−k

n−k

  (xi − xi )2

(xi+k − xi+k )2

i =1

i =1

（2-1）

式中 xi 和 xi+k 分别是时刻 i 和时刻 i + k 的交通状态参数值； xi 是从时刻 1 到时刻 n − k 的交通状态参数均值； xi+k 是从时刻 k +1到时刻 n 的交通状态参数均值。

19

第 2 章 城市路网交通时空数据特征及处理技术
Feng 等[112]针对交通流时间序列提出了长期时间依赖性（Long-range temporal dependence）和每日时间依赖性（Daily temporal dependence）。前者描述的是同一 天连续时刻交通状态之间的相关关系；后者描述不同天的同一时刻，交通流时间序 列之间的相关关系。

2.1.2 空间维特性
交通流不仅在时间维度上具有复杂的时间序列特性，在空间维度上有明显的 分布特征。本节从空间自相关性、空间异质性两方面分析路网交通流的空间维特性。
（1）空间自相关性 空间上不同路段的交通流状态之间存在依赖性，通常采用空间自相关性来量 化，能够反映不同空间位置上交通流的变化规律的相关程度。可以采用全局空间统 计量和局部空间统计量两种方式来量化空间自相关性。前者是用来分析研究对象 整体的空间自相关性，后者是用来分析每个空间对象与邻接对象之间的相关程度， 可以反映对象在空间上的集聚特征[21]。常用的空间自相关性指标有全局 Moran’s I 指数、局部 Moran’s I 指数、Geary’s 指数等等。全局 Moran’s I 指数的计算公式如 下：

nn

  wij (xi − x )(x j − x )

   I =

i=1 j=1, ji nn
w 1 ij n i=1 j=1, ji

n
(xi − x )2
i =1

（2-2）

式中 wij 是空间权重矩阵，用以量化空间对象之间的临近程度； xi ， xj 分别是位置 i 和 j 对应的属性观测值；x 是所有空间对象属性值的均值。全局 Moran’s I 指数的
范围是−1,1 。当 I＞0 ，代表对象之间空间正相关；当 I＜0 ，代表对象之间空间负
相关；当 I =0 ，代表对象之间空间不相关。文献[21]研究表明全局 Moran’s I 指数值 随着阶数增大而不断降低，表明路网不同路段之间交通流状态的相关性在空间上 随着路段间距的增长而降低。
（3）空间异质性 空间位置效果不仅体现在空间自相关性上，还表现为空间异质性。空间自相关 性受空间异质性的影响，每一个位置的属性因为其内在的独特性，导致了空间异质 性[113]。空间异质性能够反映对研究对象在空间上分布的局部集聚特征和不稳定程 度[21]。如图 2.1 所示，以上海市为例，选择早高峰时段的 8:30 时刻、平峰时段 14:00 时刻及晚高峰时段 17:30 时刻，对路网的交通速度进行可视化，可以看出，城市路 网交通流状态在空间上分布不均匀，呈现明显的集聚特征。中心区域的交通状态较
20

第 2 章 城市路网交通时空数据特征及处理技术
为拥堵，距离中心区越远，路段的交通状态越畅通。西部区域的交通状态总体上比 东部区域更拥堵。因此空间异质性能够在宏观层面上反映不同区域交通状态的影 响范围和集聚性特征。
图2.1 路网交通速度的空间异质分布
2.1.3 时空相关性 基于前文提到的交通流数据的空间和时间属性，在静态路网空间结构上叠加
动态的交通流状态变化规律，形成复杂的交通状态时空网络。路段交通流状态是相 互依赖的，而不是独立的，可能受空间邻近路段或历史时段交通状态的影响，具有 明显的时空相关性（Spatio-temporal correlations）。如图 2.2 所示，对于路网 N ，t 时刻路段 ra 的交通状态与其历史时刻 t −1或 t − n 时刻的交通状态相关，同时也受其 邻接路段 rb 甚至远距离的路段 rc 的影响。时空相关性可以用于交通流预测模型中， 有助于提高预测精度[77, 114, 115]。时空相关性的量化方法主要来源于对时间自相关性 和空间自相关性的延伸，如时空自相关函数[116]、时空 Moran's I 指数[117]等等。
图2.2 时空相关性示意图 21

第 2 章 城市路网交通时空数据特征及处理技术
2.2 路网属性
为了定量研究城市大范围内的路网交通状态变化特征，通常选择路段为研究 单位。静态路网空间属性包括路段的地理位置（起点、终点坐标）、路段长度、道 路等级（城市快速路、主干路、次干路、支路等）、限速信息、车道数量、车流方 向以及路段之间的空间邻接关系。韦伟[55]提出了基于欧式距离和网络拓扑关系两 大类方法定义路网空间邻接关系，示意图如图 2.3 所示：
①基于空间欧式距离的方法 如果两条路段质心之间的空间距离小于阈值，则两路段之间的关系是空间邻 接。本文第 3 章时空交通状态模式识别模型采用了此类定义空间邻接关系的方法， 对聚类算法进行修正。 ②基于拓扑关系的方法 城市路网具备非常复杂的空间拓扑结构，目前很多路网空间地理数据并不包 含空间邻接关系，若要对路网交通状态在空间上的分布特征做进一步的量化分析， 需要创建道路网络拓扑结构。路网上如果两条路段有共同的节点，则两路段之间的 关系是空间邻接。为了量化路段之间的远近邻接程度，将空间邻接概念扩展为高阶
空间邻接。若路段 i 至少有 k −1条连通的路段到达路段 j，则路段 i 和 j 属于 k 阶空
间邻接路段。本文第 5 章的交通拥堵状态传播模式研究，采用了此类定义空间邻 接关系的方法，考虑了路段之间的连通性。
图2.3 路网空间邻接关系
2.3 实验数据介绍
城市快速路是路网的骨干性道路（道路网主骨架），承担着绝大部分的日常通 勤交通任务。由于没有设置交通信号灯，不受混合交通流的干扰，属于连续交通流 系统[43]。实时的全路网交通流数据可以用于智能交通管理系统中监测当前的交通 流状态，实现有效的交通管理和控制。为了反映在大范围路网条件下的交通状态变
22

第 2 章 城市路网交通时空数据特征及处理技术

化情况，本研究实验数据对应的路网是上海市中心城区快速路网，主要包括由三环 快速路（内环、中环、外环）、东西南北交叉的快速路以及环路之间的连接快速路 组成，覆盖的中心城区面积约 660 平方公里。快速路与城市道路是通过不同类型 的具有成对入口和出口的立体或平交的匝道连通，用以合并或分散交通流。上海市 中心城区快速路系统和城市主干道构成了“三环十射”的路网布局结构，其中全市 快速路长度为 200 千米，干道里程 1072 千米[118]。
路网交通流数据实验集是由上海交通信息中心提供。数据采集设备是铺设快 速路地面下方的线圈检测器，可以采集交通流量、交通速度（时间平均速度）及占 有率（时间占有率）数据，如图 2.4 (a)所示，红点代表线圈检测器，在城市快速路 网上不均匀分布。为了对外发布交通状况信息，上海交通信息中心划分对路段进行 了划分，线圈检测器与划分的路段匹配方式，如图 2.4 (b)所示。将每对进出口匝道 之间的检测器采集的交通流数据集成到对应的路段上，区分交通运行方向，以路段 为基本单位，并以交通指数的形式在上海市交通出行网上公开发布，指导市民出行， 界面如图 2.5 所示（网址：http://www.jtcx.sh.cn/trafficindex.html）。
原始数据采集时间是从 2014 年 5 月 1 日至 6 月 29 日（60 天），每 2 分钟采集 一次通过车流量和速度，其中工作日共 40 天，节假日共 20 天（含五一国庆节、端 午节），对应 455 条快速路路段。保留本研究需要的属性，数据的存储格式如表 2.1 所示。没有设置检测器的路段不考虑在研究路网范围内。单向车道数分布在 2-6 之 间，分布如图 2.6 所示。

表 2.1 路网交通流数据存储格式

字段 描述 格式

FSTR_ISSUESECTID 路段编码 VARCHAR2

FDT_TIME 时间 DATE

FINT_FLOW 流量 NUMBER

FINT_VELOCITY 速度 NUMBER

23

第 2 章 城市路网交通时空数据特征及处理技术
图2.4(a) 上海快速路网；(b) 路段分割和检测器匹配分布示意图 图2.5 上海市城市快速路交通拥堵指数发布系统 24

第 2 章 城市路网交通时空数据特征及处理技术
图2.6 路网单向车道数分布
2.4 数据预处理过程
海量交通时空数据的采集和积累给在交通状态时空建模带来很大的挑战，为 了提高模型运算效率和效果，需要对高维的时空数据进行处理。交通系统实时采集 交通数据时，由于检测器损坏、通信或传输等故障，数据缺失、异常等问题难以避 免。不同国家地区的交通检测器缺失程度不一，例如，美国明尼苏达州交通管理部 门提供的交通流数据集存在缺失率超过 40%的数据；加拿大亚伯达地区的七年交 通数据集有将近 50%的数据存在缺失情况，有些时段甚至会达到 90%的数据缺失 比例[119]。因此需要针对不同的数据集采用合适的处理方法对缺失数据进行填充。
为了提高实际观测的数据质量，保证交通流时空数据挖掘模型的准确性和可 靠性，需要基于路网交通流的时空特性，对实验数据集进行预处理，减少异常数据、 缺失数据、噪声数据对于交通时空网络建模的影响。本研究针对实验数据集的预处 理过程包括：异常数据检测、数据融合、数据修复、数据滤波等环节，预处理流程 如图 2.7 所示，最后分别构建了路网交通流时空数据仓库和路网空间拓扑连接关系 表，为后续的研究准备好可使用的数据。
25

第 2 章 城市路网交通时空数据特征及处理技术

图2.7 城市路网时空交通数据预处理流程

2.4.1 异常数据检测

首先从原始数据识别异常错误数据并删除，存在交通流量、速度参数不在合理 范围的情况，或者不满足交通流参数之间的潜在数量关系的情况。交通流量参数 q 可按以下方式定义合理的取值范围：

0  q  fC C T / 60

（2-3）

式中 C 是道路通行能力（vehs/h）； T 是数据采集的时间间隔（min）； fC 是修正系
数，一般设为 1.3-1.5。在一个较短的时间范围内车流量的观测值可能大于道路的
通行能力，需要用修正系数 fC 来确定交通流量范围的最大值[120]。平均速度 v 可按
以下方式定义合理的取值范围：

0  v  fv  vl

（2-4）

式中 vl 是道路限制速度（km/h）， fv 是修正系数，一般设为 1.3-1.5。车辆超过限制 速度的情况较为常见，需要用修正系数 fv 来确定交通平均速度的最大值[120]。
《城市道路交通规划设计规范》中规定大城市快速路的机动车设计速度为 6080km/ h [121]。《城市快速路设计规程》中规定在不同设计设计车速下单条车道的通 行能力，如表 2.2 所示[122]。

26

第 2 章 城市路网交通时空数据特征及处理技术 表 2.2 城市快速路单车道基本通行能力

设计车速（km/h）

100

80

60

基本通行能力（vehs/h）

2200

2100

1800

本研究的实验路网包含不同的限速路段，大部分路段限速是 80km/h。按式（23）和式（2-4）分别计算不同限速状态的交通流参数阈值，修正系数设为 fC = 1.5 ， fv = 1.5 ，如表 2.3 所示。因此要剔除交通流量或平均速度大于阈值的异常数据。除 此之外，还需要删除平均速度为 0，且交通流量大于 0，或者交通流量为 0 且速度 大于 0 的数据。

表 2.3 城市快速路交通流参数阈值

路段限速（km/h）

100

流量阈值（vehs/2min）

110

速度阈值（km/h）

150

80

60

105

90

120

90

2.4.2 数据融合及修复
为了反映交通状态的变化趋势，针对剔除异常数据后的路段交通流时间序列 进行数据集成，属于数据层融合。Smith 等[123]指出交通流的测量时间间隔会对流 量的特性分析有影响，测量间隔太短，容易导致交通流时间序列状态缺乏稳定性， 而稳定的快速路流量可以用 10 分钟的测量间隔来计算。因此本研究把每 2 分钟间 隔的数据集成为 10 分钟间隔的数据，一方面在统计上可以显著地改善交通流时间 序列的稳定性，可以较为准确地反映交通流的特性；另一方面，可以有效压缩路网 交通流数据集的大小，降低数据的缺失率，提高路网交通时空数据挖掘的效率和效 果。将 2min 交通流量数据加和为 10min 间隔的数据，并换算成单位为 veh/h 的流 量数值 q 。计算公式如下：

 q = 6 qn 2min n

（2-5）

式中 q 是交通流量（vehs/h）； q2min 是间隔是 2min 的交通流量（vehs/h）；n 是每个
10min 间隔内有数据的 2min 间隔个数， n = 1, 2,3, 4,5 。
采用考虑交通流量权重的加权平均计算法计算 10min 间隔的交通流平均速度
v ，以及对应的交通流密度 k （vehs/km）的计算公式如下：

 v = (q2min  v) q

（2-6）

27

第 2 章 城市路网交通时空数据特征及处理技术

k= q v

（2-7）

经过数据融合后的交通流实验数据集共有 3785591 条数据，缺失 145609 条数 据。若集成后存在数据缺失率超过 20%的路段，则把这个路段的数据都剔除掉。实 验数据集有 23 条路段数据缺失率大于 20%，存在连续长时间缺失数据的情况，保 留剩下的 432 条路段作为研究路段。需要修复的短时间内缺失数据主要来源于两 部分：检测器异常导致的缺失和删除异常数据导致的缺失。本研究采用基于历史趋 势和实测数据加权估计的方法对缺失数据进行填充，计算公式如下：

xˆik

(t)

=





xik

(t

−1)

+

(1−



)



yk i −1

(t

)

（2-8）

式中 xˆik (t) 是第 i 周第 k 天待估计的缺失数据； xik (t −1) 是第 i 周第 k 天相邻时刻 t −1

的实测数据；

yk i −1

(t

)

是第

i

−1周第

k

天的历史趋势值；

是加权系数，

0





1，

权衡历史趋势和实测数据在缺失数据补偿中的作用， 越大，实测数据的影响越大，

历史趋势的影响越小，反之亦然，本研究设为 = 0.5。

估计缺失数据时考虑历史趋势数据的影响能够降低实测数据的随机干扰，提

高模型的稳定性[120]。采用指数平滑的方法计算第 i −1周第 k 天 t 时刻的历史趋势值

yk i −1

(t

)

计算公式如下：

yk i −1

(t

)

=





xk i −1

(t

)

+

(1−



)



yk i−2

(t)

（2-9）

式中

xk i −1

(t

)

是第

i

-1

周第

k

天

t

时刻的实测数据；

yk i−2

(t

)

是第

i

−

2

周第

k

天

t

时刻的历

史趋势值； 是加权系数，0    1，代表实测数据对历史趋势值的作用，本研究

设为  = 0.5 。

针对处于周末的工作日（五一假期的调休）的缺失数据，按工作日周一来计算

历史趋势值。针对处于第一周或者节假日（五一假期 2014.05.01-03、清明假期

2014.06.02）的缺失数据，不考虑历史趋势值的影响，仅考虑相邻历史时刻状态的

影响，采用均值的方法，计算公式如下：

xˆik (t) = xik (t − n) + xik (t − n +1) + + xik (t −1) n

（2-10）

式中 n 是计算均值的数据个数，本研究设为 n=5 。

2.4.3 数据滤波处理
实测数据的随机干扰会影响路网交通流时空数据挖掘模型的效果，因此需要去除

28

第 2 章 城市路网交通时空数据特征及处理技术

交通流数据中的随机成分。常用的交通流滤波方法有移动平均法、指数平滑法、小波 分解法及卡尔曼滤波法。本研究采用指数平滑法对修复后的数据集进行滤波处理，该 方法基于当前时刻的观测值和上一时刻的平滑值，不需要存储过多的历史数据，计算 复杂度低、效率快且平滑效果好，适合处理大规模路网长时间的交通流时空数据[120]。 计算公式如下：

x(t) = x(t −1) +  x(t) − x(t −1)

（2-11）

式中 x(t) 是滤波后 t 时刻的平滑数据，x(t) 是 t 时刻的实测数据， 是平滑系数，本 研究设为  = 0.8 。

2.4.4 数据预处理实例

原始的交通流数据在经过上述的预处理流程后，得到快速路网交通流时空数

据集，共包含

432

路段。以上海市南北高架路上的路段

r

（位于西侧新闸路下匝
238

道至威海路下匝道之间）为例，基于异常数据检测和融合后的数据，对于历史趋势

计算、缺失数据修复、以及滤波的结果进行展示。选择 2014 年 5 月 7 日、5 月 14

日、5 月 21 日及 5 月 28 日的速度数据，分别为第 1 周、第 2 周、第 3 周、第 4 周

的周三数据，其中前 3 周已完成缺失数据修复，如图 2.8 所示。基于前 3 周的观测

数据按公式（2-9）计算第 2 周和第 3 周周三的历史趋势值，如图 2.9 所示。

图2.8 路段平均速度变化

图2.9 路段平均速度历史趋势值变化 29

第 2 章 城市路网交通时空数据特征及处理技术
按式（2-8）基于第三周（2014.05.21）的历史趋势值，对第四周（2014.05.28） 的缺失数据进行填充，如图 2.10 所示。该方法适合离线状态下的缺失数据填充。 对缺失数据进行修复处理后，为了更为准确估计后续的缺失数据，需要更新第 4 周 的历史趋势值，第 2 周到第 4 周的历史趋势值变化如图 2.11 所示。可以看出随着 考虑历史数据的积累，历史趋势值差异较大，需要不断更新。
图2.10 2014.05.28缺失数据修复结果
图2.11 路段平均速度历史趋势值变化 按式（2-11）对修复后的数据进行滤波处理，四天的路段平均速度数据滤波前 后进行对比，如图 2.12 所示。可以看出滤波处理能够保留数据的基本变化规律， 降低随机干扰的影响。
30

第 2 章 城市路网交通时空数据特征及处理技术
图2.12 滤波处理前后数据对比
2.5 本章小结
本章介绍了城市路网交通时空数据特征分析及预处理技术。交通流数据在时 间维度上具备周期性、趋势性以及时间自相关性等特征。在空间维度上具备空间自 相关性、异质性等特征；在时空维度上，具备显著的时空相关性特征。分析了静态 路网空间属性，以及空间邻接关系不同的定义方式在后续模型中的应用。最后详细 介绍了本文的实验数据—上海市快速路路网交通流数据集及其预处理过程。经过 了异常数据检测、数据融合、故障数据修复以及滤波处理等环节，建立路网交通流 时空数据库，保证了后续交通时空数据挖掘模型的准确性。
31

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
3.1 本章引言
由于居民出行活动在统计上的非平稳性和不确定性，城市交通状态在路网空 间上呈异质性分布的特征，且不同时段的状态差异也很大，具有很强的时变特性。 数据驱动下的智能交通系统能够采集并积累大量的高时空分辨率的交通数据，可 以基于交通状态时空相似性，从中提取潜在的时空状态演变规律，一方面可以对海 量的数据实现有效的压缩，另一方面可以从宏观的视角分析路网交通状态的时空 变化模式，挖掘路网潜在的供给能力，通过交通管控策略对道路交通流进行调控和 诱导，充分利用有限的道路资源。
宏观基本图(Macroscopic fundamental diagram, MFD) [124]广泛应用于网络流量 的宏观建模和控制。然而大范围城市路网交通流的时空异质性影响着宏观基本图 是否存在及其形状[125]。Geroliminis 等[126]指出由于交通流在空间上的异质性分布， 有些路网对应的宏观交通流参数关系可能高度分散分布，并不存在宏观基本图。因 此，对于一些大范围的城市路网而言，可能由于城市交通拥堵时空分布状态的异质 性，无法使用宏观基本图来准确表征大规模路网交通流复杂的时空变化规律。为了 解决这个问题，可以将大范围城市路网划分为具有相似时空交通流模式的同质子 路网，每个子路网具备同质的交通状态变化模式，进而可以降低宏观交通流参数关 系的离散性，对于基于 MFD 的路网交通状态估计与控制有非常重要的意义。
目前基于相似性的交通状态变化模式研究是仅提取一条路段的交通状态变化 模式，在空间维度上没有考虑全路网层面的影响，或者仅基于一天甚至更短时间的 数据对路网进行划分，没有考虑交通状态在时间维度上的长期依赖性。实际上，交 通流序列的长期和短期时间依赖性同样重要[127]。本章提出了一种结合张量分解和 聚类技术的组合方法，考虑时空多维度特征，提取同质的交通状态时空变化模式。 采用非负平行因子分解算法（Non-negative CANDECOMP/PARAFAC，NNCP）从 高维交通时间序列数据中提取集合时空变化的多维特征，为后续的聚类提供了更 为紧凑的特征空间。在空间维度上，利用谱聚类（Spectral Clustering，SC）技术对 路网进行划分，通过在聚类的相似度矩阵中考虑空间邻近性，获得在空间上紧致分 布的路段聚类结果。
该方法由三个阶段构成，如图 3.1 所示。第 1 阶段，基于前文预处理的交通流 时空数据，分别建立了三维交通速度张量和密度张量。使用 NNCP 算法分解交通
32

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
速度和密度张量，同时挖掘交通状态在时间维度上短期日变化规律、长期逐日变化 规律以及空间上的分布特征，降低了海量交通流数据的冗余性，实现对时空数据的 有效压缩。
第 2 阶段，把路网三维速度张量和密度张量分解得到的空间模式上的主成分 矩阵合为一个新的交通状态空间分布特征矩阵，用于计算谱聚类算法输入的相似 度图（Similarity Graph）。提出基于空间邻近系数矩阵修正的谱聚类算法（Spectral Clustering algorithm modified by the Spatial Proximity Matrix，SC-SPM)，把路网上各 路段之间的空间邻近程度集成到高斯相似度矩阵中，识别出具有相似时空交通状 态变化规律的子路网。该算法不仅考虑了交通流状态长期逐日和短期日变化规律 的相似性，而且考虑了每个子路网在地理空间上路段分布的紧致程度，同时实现了 大范围路网的划分以及同质交通变化模式的提取。
第 3 阶段，对每个子路网对应的交通状态进行宏观交通流关系建模和可视化 呈现（Macroscopic Traffic Relationship Modelling and Visualization，MTRMV），提 取模式潜在的时空特征。通过比较各子路网宏观交通流关系图验证了交通流模式 的异质性。提出日周期性和周周期性指标，进一步表征了提取的不同交通状态模式 之间的差异性。分别分析了高峰时段和非高峰时段的每个交通状态模式对应子路 网的空间结构以及交通拥堵程度。
如果省去第 1 阶段，直接把路网上每条路段在长时间范围的交通状态合为一 个时间序列，直接作为谱聚类模型的输入，会造成维度灾难。由于维度过高，会占 用大量的计算能力，计算效率较低，且无法提取具有同质交通时空状态的子路网。 采用张量分解方法不仅能够对聚类的输入属性实现降维，提高运算效率，还可以有 效平衡长期和日常时间变化特征的权重，并尽可能多地提取时空相似性和规律性。
33

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

图3.1 技术路线

3.2 基于张量分解的多维度特征提取

3.2.1 NNCP 算法
交通状态在时间维度上的变化投影到短期和长期两个时间模式上，短期模式 是指交通流状态的日变化规律（Within-one-day temporal mode），长期模式是指交通
流状态的逐日变化规律（Day-to-day temporal mode）。本章采用三维张量Τ  RIJK
从空间路段模式、短期日变模式和长期逐日模式描述交通流状态变化的时空特征。
I , J , K 分别代表路段数、天数和一日内的时间槽数。采用张量分解的方法能够提
取多个模式的潜在特征，并用更低维的空间表示出来，识别多重相关性，从高维交 通数据中去除冗余[128]。采用正则化非负平行因子分解（regularized Non-negative CANDECOMP/PARAFAC factorization，r-NNCP）[129]的方法提取网络交通流的多维 度特征。建立三维交通速度和密度张量，分别被分解为若干个秩一张量的和，分解 公式为：

R

R

  T  Tr  ar br cr

r =1

r =1

（3-1）

式中 ar  RI , br  RJ , cr RK 是基向量，分别代表空间路段模式、短期日变模式和
长期逐日模式上时空交通流状态的变化特征。R 是每个模式上提取的主成分数量， 不会超过张量 T 的秩（Rank）。网络水平交通状态张量 T 可以视为若干个基张量

34

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
（Basic tensors）的线性组合，如图 3.2 所示。因子矩阵 A, B, C 是秩一张量基向量 的组合，维度分别是 I  R, J  R, K  R :
A = a1 a2 aR , B = b1 b2 bR , C = c1 c2 cR  （3-2）

三维交通时空状态张量可用因子矩阵近似表示为：

T = A,B,C

（3-3）

采用正则化技术对分解得到的基向量进行归一化处理，如下图所示：

R

R

  Τ  rTr'  r  ar' br' cr'

r =1

r =1

（3-4）

式中 ar' ,br' ,cr' (r =1, 2, , R) 是单位向量，Tr' 代表第 r 个正则化的基张量。

i=1,2, I

路

=

+

+ +

段 模

T

式

日模式 j=1,2 J

基张量1

基张量2

图3.2 三维交通流状态张量及其NNCP分解示意图

基张量 R

3.2.2 分解技术

NNCP 技术的目标是通过对基张量的线性组合尽可能接近城市路网范围的交 通状态张量。原始张量和重构张量之间的误差需要最小化，张量分解可以被转化为 优化问题，如下：

min Error= T－ A,B,C  2 s.t. A,B,C  0

A,B,C

F

（3-5）

式中 Frobenius 范数 * 2 是起着近似标准的作用，对 A, B, C 的约束条件代表着 F
因子矩阵的非负性。三维交通状态张量可以用 X(1) , X(2) , X(3) 三个模式矩阵表示，维
度 分 别 是 I  JK, J  IK, K  IJ 。 采 用 交 替 非 负 约 束 最 小 二 乘 算 法 （ Alternating
nonnegativity-constrained least squares algorithm，ANLS）把式（3-5）优化问题转化
为三个矩阵形式的非负约束最小二乘子问题[129]。

35

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

min
A0

X (1)－A(C

min
B0

X (2)－B(C

min
C 0

X(3)－C (B

B)T 2 F
A)T 2 F
A)T 2 F

（3-6）

式中 代表 Khatri-Rao 积[130]。采用 ANLS 方法通过固定 A, B,C 中任意两个矩阵
的方式解决最优化问题，例如当固定矩阵 B,C 时，调整矩阵 A 最小化原始张量和
重构张量之间的误差。三个 NNLS 子问题重复交替求解，直到满足收敛准则[38]。 在 ANLS 框架中采用块主旋转法（Block principal pivoting method）解决 NNLS 子 问题[129]。本章使用 Tensor Toolbox 2.5 工具箱[131]执行 NNCP 算法。

3.3 考虑空间邻近性的谱聚类算法
谱聚类算法是在 NNCP 分解得到的紧凑低维空间中进行的，目的是将城市范 围内的大规模网络划分为具有相似长期逐日变化和短期日变化规律的同质交通状
态 子 路 网 。 把 空 间 路 段 模 式 上 的 速 度 基 向 量 v = v1 v2 vR  和 密 度 基 向 量
k = k1 k2 kR'  组 合 在 一 起 作 为 谱 聚 类 的 输 入 属 性 ， 表 示 形 式 为
    F = [v, k] = v1, v2 vR , k1, k2 kR' = f1 , f2 , fR , fR+1 , fR+R' ，如图 3.3 所示。

图3.3 谱聚类算法的输入属性
3.3.1 构建相似度图
执行标准化谱聚类算法（NJW）[132]是为了最小化每个模式内部的速度-密度差 异。首先，构造了无向加权相似图来描述任意两段交通状态之间的关系。目标区域
内的路段集合对应着图结构的顶点集 S = s1, s2, , sn 。顶点 si 和 sj 之间的边是由相
似度 wij (wij  0) 赋予权重, 定义任意两个路段在空间模式上的速度-密度分量之间的
36

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

相似关系。W = (wij )i, j=1,...,n ( wij = wji ) 是加权邻接矩阵，边的权重是由高斯相似度函
数（Gaussian similarity function）计算得到：

wij

=

exp

 

−



Fi − Fj 2 2

2 






（3-7）

式中参数 控制领域的宽度范围[133]，本文设置为 = median( Fi − Fj ) 。谱聚类 的目标是找到有效的图分割方法，实现不同类之间边权重较低，且同类中的边权重 高，即为图的最小分割问题（Min-cut problem）[133]，如图 3.4 所示。

图3.4 谱聚类中的图分割问题

利用高斯相似矩阵可以表示任意两个路段在短期和长期时间模式上的交通流 状态变化的相似性，但是没有考虑空间位置上的邻近性。根据美国地理学家 Waldo Tobler 提出的地理学第一定律（First Law of Geography）：“Everything is related to everything else, but near things are more related to each other”[134]（任何事物都是与 其他事物相关的，只不过相近的事物关联更紧密），该定律反映了空间相关性，一 般来说，地理上距离较近的事物相关性越强；距离较远的事物相异性越强。
本章不仅探索了路网上具有相似的时空交通流模式，而且提高了各集群路段 的在地理上邻近性。为了将路段的空间邻近性融入聚类过程，创新性地提出了采用
用空间邻近系数修正高斯相似度矩阵W 的方法。任意两个路段之间的距离 di, j 是由 其质心坐标 (xi , yi ) , (xj , y j ) 之间的欧式距离表示，如下：

di, j = (xi − xj )2 + ( yi − y j )2

（3-8）

Pascale 等[11]使用阈值化方法考虑空间邻近性，当空间距离大于阈值时，相似
度设置为 0。按以下方式定义空间距离系数 di', j :

37

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

d' i, j

=

 dmax − di, j

 

d

max

−

dmin

，if

d' i, j



 

0,

if

d' i, j



（3-9）

为了保证空间邻近性，定义阈值 修正

d ' i, j

。如果 di', j   ,则

d' i, j

= 0,

否则

di', j 保持不变。 把 di', j 的百分位数 f % 定义为空间邻近性参数  。  变化是为了评

价参数 对聚类效果的影响。 越大，空间距离阈值 越大，路段之间的距离 di, j 越

小，代表路段空间分布更紧凑。高斯相似度矩阵修正为：

W ' =W  D'

（3-10）

式中 D' 代表空间邻近系数矩阵， di', j 是 D' 的元素。谱聚类是基于修正的相似度矩

阵W

'

=

(w )' ij i, j=1,...,n

运行，能够在空间维度上提取路段紧致分布的子路网，在实验分

析部分可以证明该方法的有效性。

3.3.2 SC-SPM 算法
归一化切割法（normalized cut，NCut）[133]属于一种图分割方法，应用在图 G=(W ', S) 上，可以定义为：

 Ncut ( A1,

,

Ak )

=

1 2

k i =1

W '( Ai , Ai ) vol( Ai )

 W '( Ai , Ai ) =

w'
iAi , jAi ij

（3-11） （3-12）

式中 Ai 是图 G 的一个顶点簇， Ai 是 Ai 的补集。 vol( Ai ) 是 Ai 包含的所有边的权重
值，规范 NCut 的目标函数，以平衡聚类集群的大小。NCut 通过最小化簇与簇之 间的边权值来对路段进行聚类，其目标函数为:

 minimize k W ' ( Ai , Ai ) i=1 vol( Ai )

（3-13）

由于要平衡簇的大小，最小化问题转化为 NP 难问题[135]。解决这个问题的
核心原理是通过标准化的图拉普拉斯算子 Lnorm 将最小化 Ncut 目标函数转化为
跟踪优化（Trace optimization）。

L = D−W'

（3-14）

38

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

Lnorm = D−1/2 LD−1/2 = I − D−1/2W D ' −1/2 = I − L'

（3-15）

 式中 D 代表对角矩阵， si 的顶点度是 di =

w n
j=1 ij

。图的切割问题是通过计算得

到 L' 的 k 个最大特征值和特征向量来求解的[136]。基于改进的高斯相似度图和归

一化切割技术，基于空间邻近系数矩阵修正的谱聚类算法（SC-SPM）如下所示：

算法 3.1 基于空间邻近系数矩阵修正的谱聚类算法（SC-SPM）

输 入 ： 将 NNCP 分 解 提 取 的 空 间 路 段 模 式 上 的 速 度 基 向 量 和 密 度 基 向 量
    F = f1 , f2 , fR , fR+1 , fR+R' 作为输入特征值；路网上的所有路段为 S = s1, s2, , sn ；
聚类数量为 k。

输出：每条路段 si 对应的聚类编号 mi 。
Step 1. 将原始数据点转换为无向图 G，按式（3-7）通过高斯相似度函数构造相似度 矩阵；

Step 2. 建立空间邻近系数矩阵 D' ，按式（3-10）把高斯相似矩阵W 修正为 W ' ；

Step 3. 构造度矩阵 D，标准化图拉普拉斯矩阵 L' = D−1/2W D' −1/2 ；

Step 4. 计算 k 个最大的特征值1, 2 k ，以及 L' 对应的特征向量 u1 , u2 . . . , uk 。构

造矩阵U =  u1 , u2 . . . , uk  Rnk ，向量 u1 , u2 . . . , uk 构成矩阵的列；

 Step 5. 按式 eij = uij

 

ui2k

1/ 2 

标准化矩阵 U

的行，得到矩阵

E



Rnk

；

k 

Step 6. 基于 K-means 算法，把矩阵 E 的行向量 e1 , e2 . . . , en 作为聚类项，聚为 k 类，

聚类集合分别为 E1, . . . , Ek 。

3.4 宏观路网交通流参数

单个路段的交通状态通常用基本图来表示，基本图描述了交通参数之间的关 系，包括交通流量、速度和占有率（或密度）[137]。本研究利用路网层面的基本图 来说明时空交通模式在空间上分布的异质性。路网水平的交通流参数之间的基本 关系如:

Q = VK

（3-16）

式中 Q 是平均交通流量；V 是平均的交通速度；K 是平均密度[138]。 Mahmassani[139]提出了加权网络平均法来表示宏观交通流参数之间的关系。为
39

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

了更准确地刻画每种模式的交通流状态，在观测期间，路网 i 的加权平均交通流量 Qi 定义为：

 qijlij  Qi = j lij
j

（3-17）

式中 qij 代表通过子路网 i 上的路段 j 的交通流量；lij 是路段 j 的长度。子路网 i 的 加权平均交通速度Vi 定义为：

 qijvij  Vi = j qij
j

（3-18）

式中 vij 代表通过子路网 i 上的路段 j 的车辆速度。 根据式（3-19）路网 i 的加权平 均交通密度 Ki 定义为：

Ki

=

Qi Vi

（3-19）

加权平均速度和密度更能代表每个子网的交通拥挤程度，因此本研究采用加 权变量作为基本流量变量来描述子路网的宏观交通流状态关系，而不使用简单的 算术平均值。

3.5 实验分析
在整个路网的交通流状态在不同观测时段变化显著。本节分别针对早高峰时 段（6:00-10:00）、晚高峰时段（15:00-17:00）和非高峰时段（10:00-14:00）建立交
通模式识别模型。三维交通速度和密度张量的维数为 43260 24 ，分别代表路段
数、天数和每日时刻数。基于上海快速路路网交通流数据，提取不同时段的时空交 通流状态模式，并进行路网划分。
3.5.1 非负张量分解 首先，将三维交通密度张量和速度张量分别分解为基本张量的线性组合。每个
模式的基向量会随着分解实验中基张量数 R 值的变化而变化。随着 R 的增大，张 量分解过程将从欠拟合过渡到过拟合[140]。在过拟合的情况下，张量分解的计算代 价更大，因为需要更多的迭代来收敛[141]。因此，应设置适当的基张量数 R ，以减
40

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
少欠拟合或过拟合对分解结果的影响。本章采用均方根误差（Root Mean Square
Error，RMSE ）来评价不同 R 值设置条件下的分解效果，代表原张量和重构张量之
间的误差：

T－ A,B,C

RMSE =

F

T

F

I JK

   (xijk

−

x' ijk

)2

= i=1 j=1 k =1 I JK

 x2 ijk

i=1 j=1 k =1

（3-20）

本章分析了早高峰时段张量分解精度 RMSE 随参数 R 的变化趋势，针对不同 的 R 值，重复 10 次实验，平均 RMSE 值随 R 的变化如图 3.5 所示。R 越大，RMSE
越小，NNCP 分解得到的基向量包含的信息越多，计算的复杂度也越大。参考张量 分解的研究，目前还没有一种有效的方法来自动选择 R 的最佳设置。如果 R 过小， 分解是在欠拟合的条件下进行的，原张量和重构张量之间的误差较大，存在较多的 信息损失，三个维度上的基向量不能很好地表征路网交通状态潜在的时空变化特 征。如果 R 过大，可能导致过拟合，分解结果会包含大量的噪声，提取出来的基向 量不能准确表征不同维度的变化规律，且计算复杂度较高[39]。
从图 3.5 中可以看出随着 R 的增大, RMSE 刚开始时显著降低，随后下降趋势 逐渐变缓。一方面，需要通过设置较大的 R 保证保留原张量中尽可能多的信息；另 一方面， 为了避免过拟合的发生 R 不能设置过大。当 R＞5 时 RMSE 下降速度变 缓, 是过拟合导致的。因此，为了权衡张量分解的欠拟合和过拟合，交通速度和密 度张量分解实验参数 R 设为 5。在空间路段维度上执行 SC-SPM 算法，得到具有相 似的长期逐日变化趋势、短期日变化规律的同质交通状态子路网。图 3.6 展示了在 空间维度上每个路段在不同模式上的基向量元素分布，不同的颜色表示元素的不 同取值，结果表明交通状态在路网空间维度上的分布具有明显的异质性。

(a)

(b)

图 3.5 在不同 R 设置条件下的张量分解误差 RMSE：(a)速度张量；(b)密度张量

41

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

(a)

(b)

图3.6 路网交通张量分解结果在空间维度上的可视化(a)速度；(b)密度

3.5.2 参数敏感性分析

为了定义各子路网的宏观交通流关系，需要保证每个交通模式对应的交通“密 度-速度”散点图分布较为集中，具有相似的交通流时空状态分布。聚类效果与空
间邻近系数  及聚类数量 k 紧密相关。为了实现一个更好的时空模式提取效果，分 析设置不同的  ，k 参数组合的实验效果。为了从不同的角度来评价聚类效果，选
择聚类指标探索参数设置的合理性，以期实现每个子路网的路段在空间上紧凑分 布，且不同交通时空状态模式之间差异明显。这三个指标从不同方面反映模型的聚 类性能，分别是簇内总方差(Total within-cluster variance，TWV)、Calinski-Harabasz (CH)[142]和 Davies-Bouldin (DB)[143]，定义如下：

 TWV =

sk 2
ii

（3-21）

TV = s2

TBV = TV −TWV CH = TBV  n − k
TWV k −1

 DB

=

1 k

k i =1

j

max
=1,2, ,k ;

j

i

 

di + di,

d
j

j

 

（3-22） （3-23） （3-24）
（3-25）

42

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
式中 TV 是路网上不考虑聚类的条件下所有路段的交通密度和速度总方差；TBV 是 簇与簇之间的总方差； k 是聚类数量， n 是路段总数量； si2 是子路网 i 中对应路段 的交通参数方差； di 和 d j 分别代表子路网 i 和 j 内的所有路段交通状态属性值的
欧式距离；di, j 代表子路网 i 和 j 所有路段交通状态属性值对应质心的中心距离。
TWV 指标可以用来评价每个子路网的同质性[144]，能够反映每个子路网内部交 通状态的相似性，但是无法反映任何两种不同模式之间的异质性。指标 CH 和 DB 不仅可以代表每个子路网交通模式的同质性，还可以反映子路网之间交通时空状 态分布的异质性。为了更为科学地评价聚类效果，本研究最终以 CH 和 DB 这两
个指标为依据，从不同的角度确定参数  和 k 的最佳组合。CH 越大，提取时空状
态模式的同质性越强；与 CH 相反，DB 越小，模型提取时空状态模式的同质性越 强。
对于参数  和 k ，其中一个的选择是受另外一个参数的影响。不同的参数组合， 会得到不同的路网划分和时空模式识别结果。不同的参数  设置对应不同的空间 接近性阈值 ，如表 3.1 所示。本节以早高峰时段提取同质交通状态时空模式为例， 实验设置不同的  和 k 参数组合。选择最优参数组合的方法是先固定一个参数， 然后调整另一个参数，选择效果最优的参数组合。参数  的取值范围设为 5%~95%
（19 个值），参数 k 的取值范围是 4~12（9 个取值），参数组合的数量为 19×9=171。
从单一指标的角度来看， 和 k 参数的最优组合设置是不同的，本文同时考 虑了 DB 和 CH 两个指标选择了  和 k 的最优参数组合。当 k=6 和 =55%时，
DB 的值最小，CH 也取得较大的值，实现了较好的同质时空模式提取效果，因此 被选为最优参数组合，可以保证子路网的路段在空间分布上的紧凑性、模式内部交
通状态的同质性以及不同模式之间交通状态的异质性。为了分析参数  对于模型
效果的敏感性，固定参数 k 的取值（ k = 6 ），三个指标的变化如图 3.7(a)所示。为
了分析参数 k 对于模型效果的敏感性，固定参数  的取值（ =55%），三个指标的
变化如图 3.7 (b)所示。 从图 3.7 (b)可以看出，当 k 的取值较大时，TWV 的值会更小。依据指标 TWV
选择的最优参数 k 与依据指标 CH 和 DB 选择的最优参数不同。不难理解，聚类数 量越多，每个类内部的方差越小，但不能反映类之间的异质性。因此在本研究中 TWV 仅用于反映簇内方差随不同参数设置的变化情况，不用于确定参数设置的指
标。当 =55%时，修正的高斯相似度矩阵可视化如图 3.8 所示, 可以看出，数值越
接近对角线，相似度越高。
43

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取 表 3.1 参数设置
 (%) 5% 10% 15% 20% 25% 30% 35% 40% 45% 50%  0.238 0.322 0.381 0.427 0.463 0.497 0.529 0.562 0.594 0.623
 (%) 55% 60% 65% 70% 75% 80% 85% 90% 95%  0.649 0.677 0.704 0.730 0.758 0.788 0.820 0.860 0.903
(a) 空间邻近性参数  ( k = 6 )
44

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
(b) 聚类数量参数 k ( =55%)
图3.7 参数设置敏感性分析
图3.8 修正的高斯相似度矩阵可视化
3.5.3 交通流变化模式分析 当上海市中心区快速路网被划分为 6 个子路网时（ k = 6 ），在参数  设置不同
数值的条件下子路网的可视化，如图 3.9 所示，证实了该算法能够将路网划分为路 段在空间上紧致分布的子路网。环形快速路被分配到不同的子路网中，但内环线内
的南北方向和东西方向形成的 “十字”快速路在不同的  参数设置的条件下都被
分配到一类中，一方面是因为路段之间的空间距离较近，另一方面也能反映中心区
快速路的交通挤塞程度是均匀分布的。随着  的增大，每个模式的路段在地理上分 布更加集中，因此证实了空间邻近系数  能有效地调节子路网上路段空间分布的
45

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
集中程度。
当参数设为 =55% ， k=6 , 每个子路网所有路段对应的交通速度和密度统计
分布如图 3.10 所示，不同模式的交通参数分布差异较大，证实了时空交通状态模 式的异质性。目前交通管理的范围是按行政管辖区域划分的，不同区域的交管局分 管不同的子路网。本文能够从数据驱动的角度为提出一个更为科学合理的路网划 分方案，辅助交管部门对大范围复杂的城市路网进行精细化、科学化的交通管理。

(a)  =35%

(b) =55%

图3.9 路网划分的空间可视化( k = 6 )

(c)  =75%

46

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取 (a)
(b)
图3.10 子路网交通参数分布( =55% )：(a) 速度；(b) 密度
47

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
为了进一步分析不同模式之间的异质性，提出基于自相关函数（Autocorrelation Function，ACF）的日变周期性（Daily periodicity）和周变周期性（Weekly periodicity） 强度指标，评估每个模式的周期性。ACF 是观测值之间的相似性的函数，可以通 过改变观测值之间的时滞长度来发现重复模式。以早高峰 Pattern 1 中的某条路段 为例，分析 ACF 随着时滞长度增大而变化的趋势，如图 3.11 所示。ACF 的变化具 有明显的周期性，时滞长度 24 的周期，符合日变周期性特征。时滞数（Lag number） 为 24 时对应的 ACF 被定义为日变周期指数 Pd （Daily Periodicity Index）, 时滞数 为 168 (24×7)时对应的 ACF 被定义为周变周期指数 Pw（Weekly Periodicity Index）。 每个子路网的宏观交通流参数的周期性指数 Pd 和 Pw 如表 3.2 所示。每个模式对应 的 Pd 和 Pw 差异较大，主要因为是工作日和周末的交通状态不同。每个模式的交通 密度周期性比速度更明显。每个模式的周期性指数存在差异，进一步说明了时空交 通模式之间的异质性。

(a)

(b)

图3.11 不同时滞长度下的ACF值 (a) 速度； (b) 密度

表 3.2 不同时空交通状态模式下的平均周期性指数

Pd _ density Pd _ speed Pw _ density Pw _ speed

Pattern 1 Pattern 2 Pattern 3 Pattern 4 Pattern 5 Pattern 6

0.423 0.461 0.440 0.400 0.490 0.566

0.383 0.347 0.371 0.308 0.459 0.423

0.479 0.455 0.470 0.462 0.530 0.563

0.409 0.257 0.360 0.299 0.442 0.297

48

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
3.5.4 子路网的宏观交通流关系
最开始基本图（Fundamental diagram，FD）是用来描述交通参数之间关系，包 括“速度-密度”模型、“流量-速度”模型及“流量-密度”模型，通过采集的车道 观测数据，拟合出最合适的函数和曲线[137]。在早期的路网交通研究中，有研究将 其扩展为网络水平的基本图[144]。Thomson[145]和 Wardrop[146]提出了中心城区的“速 度-流量”模型。Geroliminis 和 Daganzo[147]在日本横滨的实测交通流数据分析表明 在一个较大的城市区域内存在空间平均流量、密度和速度的宏观基本图 （Macroscopic fundamental diagram，MFD）关系，单个检测器的交通流参数关系散 点图分布较为离散，如图 3.12 (a)所示，但一定范围内的多个检测器集计得到的交 通流参数基本图关系散点分布集中，接近一个平滑的曲线，如图 3.12 (b)所示，证 实了路网层面上存在宏观交通流基本图关系。

(a) 单个检测器流量-占有率关系散点图 (b) 多检测器流量-密度关系散点图 图3.12 交通流基本图参数关系[147]

本章采用宏观基本图模型（MFD）来描述每个子路网交通流参数关系的基本 特征，为每个子路网分析了宏观“速度-密度”和“流量-密度”参数关系，表征不 同交通状态时空模式之间的异质性。采用式（3-17）~（3-19）针对每个子路网分别 计算加权平均流量、速度和密度。使用 Greenshields Model (1935) 式（3-26）[148]和 Underwood Model (1961) 式（3-27）[149]拟合每个子路网模式的宏观“速度-密度” 关系：

V

= Vf

(1 −

K Kj

)

（3-26）

V

= Vf

exp(−

K Kj

)

49

（3-27）

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

式中Vf 代表自由流动条件下的平均速度；K 代表平均密度；K j 为交通流量最大时 的密度。每个模式的拟合曲线如图 3.13 所示，对应的拟合精度 R2 如表 3.3 所示， 证明 Greenshields 模型和 Underwood 模型能够较好地描述宏观子路网范围内的交 通流参数关系。Greenshields 曲线拟合效果优于 Underwood 曲线。相比于其它模式， Pattern 3 和 Pattern 5 的拟合度 R2 较低，对应的宏观交通流加权平均参数的分布比 较分散。文献[150]采用不同数量的检测器数据，探索检测器数量对于宏观交通流基 本图关系图的影响，结果表明当检测器较少时，集计的曲线离散度大，随着检测器 数量的增加，离散型显著降低，呈现明显的聚合性和规律性。结合研究[150]的结论， 早高峰每个子路网包含的路段数如表 3.4 所示，可以看出 Pattern 3 和 Pattern 5 的 路段数较少，直接导致宏观 “速度-密度”交通参数关系的离散度比其他子路网要 高，进而影响模型的拟合度。另一方面，也可能是因为虽然 Greenshields 模型和 Underwood 模型在交通流建模中经常使用，但由于原始模型在采集样本上存在一 些不足，而且初始是针对单条路段交通参数提出来的模型，可能不适合描述路网整 体呈现的交通流变化规律。
各模式的宏观“速度-密度”关系如图 3.13 所示，虽然一些拟合曲线的形状相 似，但其散点图分布的集中程度和取值范围存在较大差异。为了比较不同交通模式 之间的差异性，计算不同模式下的 Greenshields 模型关键参数，临界交通密度 Km 和通行能力 Qm 计算公式如下：

K m

=

Kj 2

(3-28)

Qm =Vm

 Km

=

1 4

V

f

 Kj

(3-29)

各模式对应的 Greenshields 模型关键参数如表 3.5 所示。单条路段的自由流速 度Vf 一般介于道路限速和设计车速之间[151]，表 3.5 中罗列的不同交通状态模式下 的子路网关键速度参数除了 Pattern 5 基本符合要求。Pattern 5 对应的Vf 值略小， 是由 Greenshields 模型对该模式的“速度-密度”关系拟合度较低导致。各模式的临 界密度和通行能力不同，进一步证明了交通模式的时空异质性。这些关键的交通参 数可应用于基于 MFD 的各子网交通控制中，促进路网交通状态的精细化管理。
虽然“速度-密度”模型在理论研究上有一定的优势，在交通控制研究上应用 更广泛的是“流量-密度”模型，被认为是交通流的基本图。早高峰时段路网宏观 交通流基本图关系“流量-密度”散点图如图 3.14 所示，可以看出每个模式的散点 分布和范围差异较大。Pattern 6 的交通流状态最为拥堵，交通流密度和流量均大于

50

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

其他模式，而 Pattern 5 的交通密度和流量明显低于其他模式。“流量-密度”基本图 形状与文献[144]中提取的子路网的宏观基本图“流量-密度”关系散点图形状相似， 证实了该方法的有效性。
为了说明路段数量对于宏观交通参数基本图集聚效果的影响，以 Pattern6 为 例，分别绘制不同路段数量下的宏观“流量-密度”基本图，如图 3.15 所示，每个 基本图对应的时段为 60 天早高峰时段（6:00-10:00），共计 1440 条数据。从图 3.15(a) 和(b)可以看出，单条路段的“流量-密度”基本图散点位置较分散，且处于交通拥 堵区域的散点较多（红圈内）。从图 3.15(c)-(h)可以看出，随着集计路段数量的增 加，宏观“流量-密度”基本图越来越集聚，流量和速度取值范围缩小，而且处于 交通拥堵区域的散点减少。每个模式对应的宏观“流量-密度”图是基于子路网上 多条路段的数据集计得到的，能代表子路网的整体交通流关系特征，散点分布较为 集中，与单条路段的基本图的散点分布差异较为明显，与文献[147]的研究结论一致。
本章提出的模型属于时空聚类模型，不仅考虑了子路网内部交通状态时空变 化规律的相似性，而且考虑了子路网的交通模式之间的差异性，以及空间路段分布 的紧密性。虽然有些路段的流量状态相似，但它们在地理上距离很远，因此被分配 到不同的子网。从上文的分析可以看出，每个子路网的宏观基本图模型能够表征每 个子区域的宏观交通流特性。各子路网宏观交通关系的差异性足以区分不同的交 通状态模式，可应用于基于 MFD 的大规模路网交通控制与管理，缓解交通拥堵。 对于每个子路网而言，当交通密度超过临界值时，采取基于 MFD 的调控措施来减 少流入子路网的交通流量，进而有效控制全市路网范围的交通流量。此外，可以将 同质的交通时空状态模式与路网层面流量状态预测的研究结合起来，以提高预测 准确性，将在本文第 6 章展开详细的讨论。

表 3.3 Greenshields 和 Underwood 模型的拟合精度 R2

Pattern

1

2

3

4

5

Greenshields Model Underwood Model

0.925 0.917

0.899 0.89

0.741 0.733

0.967 0.959

0.535 0.532

6 0.959 0.95

表 3.4 早高峰子路网的路段数

Pattern

1

2

3

4

5

6

路段数

87

69

55

124

34

63

51

Pattern
Vf (km/h)

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取 表 3.5 早高峰时段的 Greenshields 模型关键参数

1

2

3

4

5

80.43

80.42

84.59

82.6

78.98

K j (vehs/km) 81.64

89.72

87.24

76.21

76.97

Km (vehs/km) 40.82

44.86

43.62

38.11

38.49

Qm (vehs / h)

1642

1804

1845

1574

1520

6 80.4 95.73 47.87 1924

图3.13 不同模式对应的Greenshields和 Underwood 模型曲线拟合 52

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

图3.14 每个模式的宏观交通“流量-密度”散点图

(a)路段 r216
53

(b) 路段 r220

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取

(c)5条路段

(d)10条路段

(e) 20条路段

(f) 30条路段

(g) 40条路段

(h) 50条路段

图3.15 不同数量的路段对应的宏观交通“流量-密度”散点图

3.5.5 高峰期与非高峰期的交通模式
路网水平的交通拥堵状态在时间和空间上均具备较强的异质分布特征。本节 通过比较高峰时段和非高峰时段的时空交通状态模式，分析交通时空状态的异质 分布特征。采用基于张量分解的谱聚类方法提取高峰时段和非高峰时段的交通模
式，主要参数设置为 =55%， k=6 。
路网划分的结果在地理空间上体现为子路网内部的路段是紧凑分布的，并且 在不同的时间段子路网的分布不一致，如图 3.16 所示。存在一些路段在高峰和非

54

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
高峰时段划分到不同的子路网中，例如路段 a, b, c。根据表 3.6 中每种模式的平均 交通流量，可以将划分的子路网分为为轻、中、重交通子路网，其中，Pattern 3 和 Pattern 5 对应的是交通量较小的子路网(Light-traffic subnetwork)，Pattern 1 和 Pattern 2 对应的是交通量一般的子路网(Medium-traffic subnetwork)，以及 Pattern 4 和 Pattern 6 对应的是交通量大的子路网(Heavy-traffic subnetwork)。
无论是高峰时段还是非高峰时段，Pattern 5 的交通状况最畅通，Pattern 6 的交 通状况最拥堵。这是因为 Pattern 6 对应的子路网位于上海市中心城区，交通负担 严重，官方公布的最拥堵的路段也集中于此。在上海市整个快速路网中，“申”字 型高架道路系统是由南北高架、延安路高架、内环线高架、沪闵路高架、逸仙路高 架等构成， 其出行量占中心区总出行量 30%，承担着中心区主要的交通量 [152]。 在本研究中“申”字形高架路被拆分到 Pattern 1，Pattern 2，Pattern 4 和 Pattern 6 中，总体上这四个模式对应的子路网交通流较大。Pattern 3 和 Pattern 5 对应的子路 网位于东部地区，开发程度较低，此区域的出行量较低，交通顺畅。此外，不同区 域的限速差异较大，也影响交通的拥堵程度，例如浦东外环限速 100km/h，浦西外 环限速 80km/h，个别路段甚至限速 60km/h。总体而言，上海城市快速路网的中西 部地区比东部地区拥堵，原因是中西部地区较东部开发程度高，交通出行需求量更 大。该方法能够将路网划分为具有相似交通拥堵水平的独立子路网，并且与城市的 实际功能区分布一致。
非高峰时段和晚高峰时段 Greenshields 模型的交通流关键参数如表 3.5、3.7、 3.8 所示，不同时段不同模式对应的交通流关键参数存在明显差异。因此基于宏观 基本图的交通控制策略需要在不同时期针对每个子路网进行调整，最大限度地提 高城市路网的承载力。

(a) 早高峰时段

(b) 平峰时段

(c) 晚高峰时段

图 3.16 不同时段上海市快速路网划分结果的空间可视化

55

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取 表 3.6 不同时段交通状态模式的平均流量（vehs/h/lane）

早高峰时段

6:00-10:00

Pattern1

882

Pattern2

706

Pattern3

617

Pattern4

925

Pattern5

377

Pattern6 1249

平峰时段 10:00-14:00
1021 777 528 993 369 1192

晚高峰时段 15:00-19:00
1048 600 835 1023 392 1164

Pattern
Vf (km/h) K j (vehs/km) Km (vehs/km) Qm (vehs / h)

表 3.7 非高峰时段的交通流关键参数

1 87.13

2 85.31

3 86.56

4 86.47

68.85

66.39

64.78

46.73

34.43

33.20

32.39

23.37

1500

1416

1402

1010

5 82.42 46.72 23.36 963

6 84.00 79.96 39.98 1679

Pattern
Vf (km/h) K j (vehs/km) Km (vehs/km) Qm (vehs / h)

表 3.8 晚高峰时段的交通流关键参数

1 86.44

2 85.69

3 83.78

4 86.02

72.86

78.44

79.10

70.07

36.43

39.22

39.55

35.04

1575

1680

1657

1507

5 82.25 57.49 28.75 1182

6 82.40 84.94 42.47 1750

56

第 3 章 考虑时空多维度特征的同质交通状态变化模式提取
3.6 本章小结
本研究提供了一种组合聚类方法来提取同质的交通流状态时空变化模式，并 将大规模城市路网划分为具有相似拥堵水平的子路网。利用 NNCP 算法提取交通 状态在时间维度上的短期日变化规律和长期逐日变化规律，以及在空间维度上的 分布特征，为谱聚类算法提供了低维的输入特征空间。利用空间邻近系数修正的高 斯相似矩阵来保证每个子路网的路段在空间上紧密分布。
基于上海市快速路网的交通流数据对该方法进行了实证分析。实验表明每个 子路网具备相似时空交通状态模式，模式之间的交通流参数分布特性差异性明显。 在高峰期和平峰期，城市路网划分结果在不同，且与城市功能区域分布高度一致， 可以分为轻、中、重交通子路网。上海中心区路网被认为是最拥堵的区域，在高峰 时段和非高峰时段都承担着严重的交通负担，与其所处的重要地理位置相符合。对 每个子路网而言，宏观路网交通流参数关系都有较好的拟合效果，且时空分布的异 质性较为明显。研究结果可直接应用于基 MFD 的交通控制与管理策略，缓解交通 拥堵。
本研究提供了从宏观角度深入挖掘城市路网交通流状态时空特征的方法。因 为缺少检测器，导致有些路段的交通状态难以获得，没有真实数据（对应路网上灰 色路段）。若考虑路网的连通性，忽略这些缺失数据路段在路网中的拓扑连接关系， 建立全路网其他路段之间的拓扑连接关系，则会影响与其邻接路段的分类，进而影 响子路网结构，因此本研究没有考虑子路网内部路段的连通性，而是采用空间邻近 系数来修正高斯相似度度矩阵的方法来考虑空间邻接关系。该算法适用于提取缺 少路段交通状态数据的路网划分研究。未来的研究工作可考虑采用多源数据填补 缺失路段的交通状态数据，构建具备全数据的道路网络拓扑结构，同时考虑空间邻 近性和路网拓扑连通性，尝试使用社团发现算法，实时动态地提取路网交通状态的 时空模式。
57

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
4.1 本章引言
交通时空数据挖掘的任务之一是找出时空变量之间潜在的关联关系。关联规 则挖掘是一个常用从数据中提取元素之间关联关系的方法，通过置信度和相关性 来推断“A 事件存在意味着 B 事件存在”统计性的关系规则，但是无法明确是 A 事件的出现导致了 B 事件的发生，还是其他因素或者现象导致二者同时出现[153]。 对于复杂系统，若两个变量存在相关关系，不一定存在因果关系；但若存在因果关 系，则两变量一定是相关的。相比于变量相关性和关联性，基于因果关系挖掘的模 型具备更强的约束和解释性。在智能交通系统中，挖掘交通流时空数据背后的因果 关系对于发现路网状态演变规律、路网状态评估以及实施交通管控决策有重要的 研究意义。
城市道路交通网络是一个结构复杂的时空网络，挖掘路网不同路段的交通状 态之间的相互影响关系，识别路网上的关键路段，对于优化路网规划设计起着关键 的作用。目前关于城市路网时空交通状态的研究主要是采用时空相关性分析方法， 研究不同路段交通状态的关联性。实际上城市路网的交通状态不仅存在时空相关 性，而且具有因果关联性。例如某条路段发生拥堵，受车流冲击波的影响，导致上 游一定空间范围内交通状态变为拥堵，可以认为两个拥堵事件具有时空因果关系。 在大范围的路网时空范围内，不同路段的交通状态也会存在因果关联关系。除了车 流波在物理空间上的传播外，信息的传播和共享也会促进交通状态之间建立时空 因果关系。例如北京西三环发生了一起严重的交通事故，一段时间后距离较远的东 四环出现了严重的交通拥堵，主要原因是事故发生后交通管理部门发布了西三环 交通事故信息，并进行交通诱导，导致大量的驾驶员选择东四环的路径，可以认为 两个交通事件之间也存在因果关联性。
目前对于复杂系统的因果关系缺乏一个统一的定义，可以采用多种方法量化 不同变量之间的因果关系，可以分为两类：1）先验知识法：根据先验知识直接定 义变量之间的因果关系，如符号有向图法、专家系统法；2）数据驱动法：基于不 同的过程数据计算方法，判别变量之间的因果关系，如时延相关性分析法、互信息 法、格兰杰因果分析、贝叶斯网络、频谱分析等等。[154][155]
正如前文所述，目前在交通时空状态因果关系挖掘研究领域，依据交通拥堵或 异常状态发生的先后顺序等简单的先验知识来定义因果关系，没有量化变量之间
58

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
潜在的因果关系强弱程度；或者采用基于贝叶斯网络的数据驱动方法，因其参数估 计复杂，不合适应用于大规模的城市路网。为了表征路网系统复杂的非线性特征， 充分挖掘交通状态数据背后有价值的信息，本章从交通流状态信息传递量的角度 定义因果关联关系，考虑状态发生的时间先后顺序，基于多变量交通流时间序列展 开城市路网交通状态时空因果关系建模研究，量化不同路段状态之间的因果关系。 采用较新的因果关系分析方法——传递熵（Transfer Entropy），基于大量的交通流 时间序列数据，针对路网时空交通状态建立因果关系挖掘模型，量化不同路段交通 时空状态的因果关联性和相互作用，能表征交通变量之间信息传递的时序动态性， 有助于发现不合理的路网设计，识别对外影响作用大的关键路段。针对关键路段采 取科学的管控措施，优化路网结构设计，可以提高交通运行效率。
传递熵是信息熵理论中较为新兴的理论，已经被证明适合用于分析多种时间 序列数据。该方法是基于信息传递量探索变量之间的因果关系，将仅表示大小的变 量信息熵拓展为可同时表示大小和方向的矢量。与格兰杰因果关系相比，传递熵考 虑的是变量之间的信息传递，不需要假定变量之间的关系形式，适用于对非线性系 统的变量进行因果关系分析，已被广泛用于生物（脑电图和神经信号）[156]、化学 [157]、金融[158]等领域，适合分析长度较大的时间序列关系。城市交通系统是一个动 态复杂的非线性系统，采用传递熵算法能够分析海量交通流时间序列数据的因果 关联性及信息传递的方向性，挖掘路段交通状态之间的影响关系。Muñoz [159]提出 在不同模式下交通流信息传播的差异性：在交通畅通状态下，交通流信息传递方向 与交通运行方向一致；在交通拥堵状态下，交通流信息传递方向与交通运行方向相 反。因此交通状态传播具有明显的方向性。传递熵能够描述这种状态传播的方向性， 适用于分析交通网络的时空因果关系。
本章从因果关系挖掘的角度对路网交通状态时空的相互影响关系进行建模， 同时兼顾交通流时序关系和因果关系的数据挖掘关联规则，技术路线如图 4.1 所 示。需要解决的三个问题：1）如何定义路网上不同路段之间的因果关系？2）如何 基于非平稳的交通状态时间序列构建因果依赖关系模型？3）如何利用时空因果关 系评价路网交通时空状态和空间结构特征？
首先，基于大量的路网交通流时间序列数据，采用传递熵理论对交通时空因果 关系进行量化，利用滑动窗口技术和高斯核密度估计的方法来构建传递熵矩阵，能 够表征大范围的城市路网交通状态演变过程各路段交通变量之间在时间维度上的 动态信息传递量。
其次，基于因果关联系数矩阵，提出被影响系数和影响系数指标，定量地分析 不同时段下任意一条路段对路网上其他路段交通状态的影响程度和被影响程度。
59

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
最后，采用因果显著性检验方法，建立具有显著因果关系的动态时空因果关系 图。提出输入度和输出度指标，并分时段做路网可视化，识别路网上的关键路段。

图 4.1 交通时空状态因果关系挖掘研究技术路线

4.2 传递熵模型

4.2.1 信息熵基本概念

为了解释传递熵概念，本章首先介绍信息熵的基本理论。Shannon 于 1948 年 利用概率统计的方法定义了信息量和信息熵。假设事件 X 有 n 个状态 xi (i = 1, 2 n) ， 状态 xi 出现的概率是 p(xi ) ，则 xi 的自信息量定义为：

I (xi ) = − log p(xi )

（4-1）

由式（4-1）可知，I (xi )  0 ，随机事件的发生概率越大，自信息量越小，不确 定性越小；发生概率越小，自信息量越大，也不确定性越大。对于确定的事件来讲，
发生概率 p(x)=1，自信息量是 0。信息熵 H (x) 是信息量 I (xi ) 在数据集 X 上的数学
60

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
期望，计算公式如下：

n
 H (x) = E[I (xi )] = − p(xi ) log p(xi ) i =1

（4-2）

信息熵 H (x) 能够反映 X 状态出现的平均不确定度，反映信息量的大小，即信
息熵值越大，X 系统信息量越大，复杂度越高；信息熵值越小，X 系统信息量越小， 复杂度越低。利用信息熵可以来描述分析系统的状态。由于系统一般由多个变量构
成，使用平均互信息 M (X ,Y )（Mutual information）量化具有相关性的两个变量之
间的共同信息，计算公式如下：

 M (X ,Y ) =

n i=1

n
p(xi , yi ) log2
j =1

p(xi , y j ) p(xi ) p( yi )

（4-3）

互信息量 M (X ,Y ) 越大，变量 X, Y 的相关性越大，可以转化为信息熵的组合，
如下：

M (X ,Y ) = H (Xi ) + H (Yj ) − H ( Xi ,Yj )

（4-4）

可以看出互信息是变量 X, Y 的独立信息熵与其联合信息熵的差，表示变量 X,
Y 共同信息量的大小。共同信息量越多，则互信息 M (X ,Y ) 越大，X, Y 关联性越强。 共同信息量越少，则互信息 M (X ,Y ) 越小，X, Y 关联性越弱，X, Y 关联性越弱。如 果变量 X, Y 相互独立，互信息 M (X ,Y ) 是零。
此外，条件信息熵可以刻画信息量在时间上的传递性，计算公式如下：

 H ( Xi+1 X ) = − p(x i+1, xi ) log2 p(xi+1 xi )
x i+1, xi

（4-5）

条件信息熵 H (Xi+1 X ) 代表变量 X 的当前状态 xi 向未来状态 xi+1 传递信息量的 大小。同样地，条件互信息 M (Xi+1,Yi+1 X ,Y ) 可以表示变量 X, Y 同时向将来时刻传
递信息量，计算公式如下：

  M ( X i+1,Yi+1

X,Y) =
x i+1, xi y j+1 ,y j

p(x i+1, xi , y i+1, yi ) log2

p(xi+1, xi yi+1, yi ) p(xi+1 xi ) p( yi+1 yi )

（4-6）

从式（4-6）中可以看出互信息和条件互信息可以用于量化变量之间的静态依 赖性，不能刻画时间序列的动态性。互信息具有对称性特征，无法表征变量之间信 息传递的方向性。

61

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
4.2.2 传递熵理论
Schreiber[160]基于信息论和信息熵概念提出用传递熵（transfer entropy）来度量 两个系统之间的信息传递量（信息交换），度量系统之间非对称的相互作用，适用 于非线性和不对称系统。与其他交互信息的概念不同，传递熵的非对称特性使其成 为度量因果关系的指标。离散过程的传递熵表达式为：

 TEY →X

=
xi+1 , xik , xil

p(xi+1, xi(k ) , yi(l) ) log

p( xi +1

x(k) i

,

y(l) i

)

p(xi+1 xi(k ) )

（4-7）

式 中 X ,Y 代 表 两 个 变 量 ， xi , yi 分 别 代 表 i 时 刻 变 量 X ,Y 的 取 值 。

  x(k) i

=

xi , xi−1,

, xi−k+1 代表变量 X 在 i 时刻及往后顺延至 i − k +1时刻的取值，即过

  去 k 个时刻的取值； yi(l) = yi , yi−1, yi−l+1 代表变量 y 在 i 时刻及往后顺延至 i − l +1

时刻的取值，即过去 l 个时刻的取值。 p(xi+1, xi(k) , yi(l) ) 是联合概率， p(xi+1

x(k) i

,

yi(l

)

)

和 p(xi+1 xi(k) ) 是条件概率。

信息熵代表已知 xi(k) , yi(l) 和仅已知 xi(k ) 条件下 xi+1 的信息熵的差异，能够测量在

Y 已知的条件下 X 未来不确定性的降低，即已知源变量 X 的历史状态和目标变

量 Y 的历史状态，对 Y 的当前状态不确定性的降低量比仅考虑 Y 的历史状态

对其不确定性的降低量提高了多少。当 X 在某一时刻的状态完全由其历史状

态决定，与 Y 无关，则传递熵取值为 0。参数 k,l 是分别是计算变量 X ,Y 传递熵

嵌入的维度。估计多维度的联合概率密度需要的计算能力和样本量会随着嵌入维

度 k,l 的增大而增大。考虑信息在变量之间的传播存在延迟，Bauer[161]把预报范围

h 考虑进来，把式（4-8）改写为：

 TEY →X

=
xi+1 , xik , xil

p( xi + h

,

x(k) i

,

yi(l

)

)

log

p( xi + h

x(k) i

,

y(l) i

)

p(xi+h xi(k ) )

（4-8）

传递熵的定义是基于系统满足马尔科夫过程的假设，即当前的状态仅仅依赖 于过去一定长度时间的状态。如果马尔科夫状态不能被满足，传递熵可能无法度量 系统内的因果关系。城市路网交通流受人、车、路等多种因素的影响，每个因素之 间相互影响导致路网交通状态具有较强的不确定性。在交通流领域中，已有较多的 研究与随机过程理论结合，认为交通流参数随时间的变化过程满足马尔科夫性质， 可视为马尔科夫过程，具有无后效性[162, 163]。因此传递熵算法适合分析路网交通系 统的时空因果关系。

62

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
4.2.3 传递熵计算方法
为了计算传递熵，需要大量计算联合概率。本文采用核密度估计函数 （Probability Density Functions）的方法估计联合概率密度，估算某个变量的概率密
度 p(x) 公式如下：

 1 N
p(x) = N i=1 K (x − xi )

（4-9）

式中 K (x − xi ) 是 xi 处的核函数，概率密度 p(x) 是一定范围内历时数据点核函数的
均值。核密度估计是常用的概率密度估计方法，不依赖于数据的先验分布，可以解 决数据的非高斯分布问题[164]。本研究采用核密度估计常用的高斯核函数估算路段 交通状态的概率密度，公式如下：

K (x − xi ) =

1

e−

(

x− xi 2 2

)2

2 

（4-10）

可以看出 xi 与 x 距离越近，核函数越大。 是计算核函数对应的窗宽。 x, y 的 联合概率密度 p(x, y) 计算公式为：

 1 N

p(x, y) =

N

K (x − xi , y − yi )
i =1

（4-11）

对应的联合高斯核函数计算如下：

K(x

−

xi ,

y

−

yi )=K (x

−

xi )K ( y

−

yi )=

1 2

2

e−

(

x

−

xi

)2 +( 2 2

y

−

yi

)2

（4-12）

变量之间的相互作用关系随时间会发生变化，本文采用滑动窗口的方法来动 态计算变量之间传递熵，得到传递熵曲线。滑动窗口是通过定义窗口宽度 w 和窗 口移动步长 l 这两个参数来更新采样数据，把原始状态空间划分为 n 个连续的子空 间 Si ，每个窗口宽度包含 w 个数据，每个移动步长包含 l 个采用数据（l<w）。这两 个参数的值设置要合适，窗口宽度 w 不能过小，否则窗内样本容量过小，影响核 密度估计的准确度。移动步长 l 不能过大，否则不是及时反映信息传递过程的变化。 如图 4.2 所示，对于总长度为 L 的时间序列，滑动窗口以固定步长 l 开始滑动，对
于每个滑动窗口按照式（4-8）采用概率密度计算对应的传递熵，计算 p = L − w +1
次传递熵值，构建传递熵向量，可以得到一个能够反映信息传递量时变的动态传递 熵曲线。

63

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘

图4.2 滑动窗口示意图

本文以路网交通状态为研究对象，每条路段的交通状态可以视为一个变量，路 网是由 m 条路段构成，则总变量数为 m，计算任意两个变量之间的传递熵，考虑 传递熵的方向性，在每个滑动窗口内，需要计算 m(m −1) 个路段对的传递熵，得到 一个二维传递熵矩阵 Tmm 。考虑传递熵的方向性， tij  t ji ，对角线上传递熵为 0， 如下：

 0 t12

t1m 

Tmm

=

 

t21



0

t2

m

 



tm1 tm2

0

 

（4-13）

把每个滑动窗口计算得到的传递熵矩阵Tmm 沿行展开，剔除对角线的零元素，

得到传递熵向量 tei = [t1i2,t1i3,

t1im , t2i1, t2i3,

ti
m(m−1)

]

。当窗口从时间序列的开始端滑动

到结束端，得到 p 个传递熵向量，整合所有的向量形成维度为 p  (m2 − m) 的路网

交通状态传递熵矩阵 te ，能够表征任意两条路段之间的交通状态传递信息大小。

te

=

tt111222

, ,

t113 t123

, ,



t1p2 , t1p3,

t11m , t211, t213 , t12m , t221, t223 ,
t1pm , t2p1, t2p3 ,

tm1 ( tm2 (

m m

−1) −1)

  



tmp(

m

−1)

 

（4-14）

4.2.4 因果关系判断方法 在因果关系挖掘模型中，需要确定原因变量和结果变量，前者是导致某个事件
发生的变量，后者是由原因变量引起的能够代表结果事件发生的变量。在路网交通 时空状态模型中需要确定原因变量和结果变量。
64

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
从上文中传递熵的概念可知，传递熵综合了信息熵、概率分布及统计等理论， 可以对变量时间序列进行因果关系分析。信息在不同方向上的传递量是不同的，因 此传递熵具有不对称性， TEY →X 和 TEX →Y 不相等。为了表征因果关系的方向性和 强弱，引入因果关联系数 X ,Y ，对因果关系强度建模（Causal strength）[165]。通过 比较 Y 对 X 的影响和 X 对 Y 的影响，度量两变量之间因果关系的强弱，计算公式 如下：

X ,Y = TEY →X − TEX →Y

（4-15）

当 Y → X 方向的传递熵TEY →X 大于 X → Y 方向的传递熵TEX →Y ，则 Y 是 X 的 原因，因果关系的传播方向是Y → X ；反之，当Y → X 方向的传递熵TEY →X 小于 X → Y 方向的传递熵TEX →Y ，则 X 是 Y 的原因，因果关系的传播方向是传播方向 是 X → Y ；当两个方向的传递熵 TEY →X 和TEX →Y 相等，因果关系系数 X ,Y = 0 则变 量 X ,Y 没因果关系。由于系统的噪声和干扰，X ,Y 一般不等于 0。如果两变量之间 的因果关联系数 X ,Y 过小，则其因果关系不明显；如果因果关联系数 X ,Y 过大，则 其因果关系显著，有必要设定一个因果关系系数阈值，定义有效因果关系，即因果
关系显著性检验。因果关系系数 X ,Y 超过阈值，则 X ,Y 之间存在明显的因果关系。 因果关系检测可以被定义为一个假设检验问题，空假设是 X ,Y 小，则 X ,Y 之
间没有因果关系。若 X ,Y 大，空假设被拒绝，即 X ,Y 之间存在因果影响。为了执行 假设检验，Bauer[161]采用蒙特卡罗的方法重新构造新的替代时间序列，这个重构序 列必须满足以下假设： X ,Y 之间的因果影响关系完全被破坏，同时变量 X ,Y 的统
计特性没有发生改变。本文采用 Duan 等[166]提出的打乱原有时间序列的方法构造
替代时间序列。从样本个数为 L 变量 X ,Y 时间序列中重构替代时间序列 X ',Y ' 计
算如下：

 X Y '

' = [xi , xi+1, = [ y j , y j+1,

, xi+M −1] , y j+M −1]

（4-16）

M 是重构时间序列 X ',Y ' 的样本个数， i, j 随机从[1, 2 L − M +1] 中取值， X ',Y ' 相当于从原始 X ,Y 序列中截取部分数据，所以满足统计属性与原始数列保 持一致。 i − j  e ，且e 设置为一个足够大的正整数，远大于预报范围 h ，X ',Y ' 相
差足够的长度，从而保证重构序列之间没有相关关系。按照这种方式构造满足重构
序列假设条件的 Ns 个样本数为 M 的时间序列对，分别计算因果关系系数，得到 ρ = [1, 2, 3, , Ns ] ，并求得 Ns 个的因果关联系数均值  和标准差  。按式（417）判断变量之间因果关系的显著性：

65

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘

X ,Y −   3 

（4-17）

显著性阈值可设为  =  + 3  。当因果关系系数 X ,Y 小于阈值  ，则变量 X ,Y 之间没有因果关系；当因果关系系数 X ,Y 大于阈值  ，则变量 X ,Y 之间存在因果关
系。

4.3 路网交通状态时空因果关系建模

图模型（Graphic Models）是将研究对象以图的形式建模，由节点和边构成。 本研究把路段抽象成图的节点，把路段之间交通状态的因果关联性定义为边。每个
节点代表每条路段的交通状态，每条边代表两个路段交通状态之间的因果关联关
系。任意两个路段之间因果关联强度定义为：在一个时间窗口内[t −1,t] 内，路段 ri
的交通状态和路段 rj 的相互影响程度，通过计算两条路段之间不同方向的传递熵
TErj →ri 和 TEri →rj 的传递熵，按照式（4-15）计算任意两条路段因果关系系数 ri ,rj ，
定义边的权重，建立传递熵因果关系矩阵 W，计算公式如下：

W

=

wi, j =1, 

 wi, j =0,

  TEri →rj  TErj →ri 且  ri ,rj 其它

（4-18）

对于存在强因果关联性的边权重设为 1，对于因果关系不明显的两条路段，边 权重设为 0，也可以认为连接边不存在。考虑传递熵具有方向性，构造的因果关系 图为有向图。真实的路网时空交通状态一直都随着时间而变化，对应的因果关系图 结构和属性都处于动态变化之中，即形成动态时空因果关系图（Dynamic spatiotemporal causal graph）。算法流程如图 4.3 所示。

66

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘

图4.3 算法流程图

4.4 实验分析

4.4.1 参数分析

由式（4-8）可以看出计算两个变量之间传递熵需要确定参数 k, l, h，其中 k 和

l 是变量嵌入的维度，考虑计算能力有限，本研究的参数 k 和 l 均设为 1。Bauer 形

式的传递熵考虑了变量的预报范围，能够估计存在时间延迟的因果关系强弱。但是

Yang 等[167]指出采用 Bauer 的传递熵计算方法有时可能不准确，是因为参照值 xi(k) 未来不确定性降低。随着预报范围的增大，参照值也会变化，本研究采用 Shu[168]

提出的修正传递熵形式，用

x(k ) i+h−1

代替

x(k ) i

，参照值是固定的，不会随着

h

的变化而

变化，更适合估计时间延迟的传递熵。计算公式如下：

 TEY →X

=
xi+1 , xik+h−1 , xil

p(

xi+h

,

x , (k ) i +h−1

yi(l

)

)

log

p( xi + h

x , (k ) i +h−1

yi(l

)

)

p( xi + h

x ) (k ) i +h−1

（4-19）

时间间隔为 10 分钟，设模型最大时间延迟时间长度为 40 分钟，时间延迟参 数 h 分别设为[1，2，3，4]。由于传递熵具有方向性，需要计算任意两条路段不同
方向的信息传递熵，以路段 r220 和 r223 为例（ r220 是 r223 上游路段）， TEr220 →r223 和

67

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
TEr223→r220 的变化趋势分别如图 4.4 所示，可以看出传递熵随时间变化明显。
(a) TEr220 →r223
(b) TEr223 →r220 图4.4 不同方向传递熵值随时间的变化
相邻路段 r220 和 r223 在早高峰时刻 8:30、平峰时刻 13:30 以及晚高峰时刻 18:30， 不同方向的传递熵值如表 4.1 所示。可以看出对于路段 r220 和 r223 在早高峰 8:30 和 晚高峰 18:30，r223 → r220 方向的传递熵大于 r220 → r223 方向的传递熵；在平峰 13:30， r223 → r220 方向的传递熵小于 r220 → r223 方向的传递熵。因此对于这两条路段而言， 在早晚高峰拥堵时段下游路段对上游路段的影响更为明显，平峰期上游路段对下 游路段的影响更为明显。
68

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘 表 4.1 不同时段的传递熵值

早高峰时刻 8:30

平峰时刻 13:30

晚高峰时刻 18:30

TEr220 →r223

TEr223 →r220

h=1 0.0169 h=2 0.0133 h=3 0.0152 h=4 0.0137

0.0120 0.0485 0.0459 0.0567

TEr220 →r223

TEr223 →r220

0.0205 0.0205 0.0112 0.0205

0.00722 0.00749 0.00749 0.00751

TEr220 →r223
0.0173 0.0172 0.0173 0.0172

TEr223 →r220
0.0250 0.0247 0.0234 0.0228

除了嵌入参数 k 和 l 和时间延迟参数 h 之外，因果关系系数阈值  也需要设 定。随着因果关系阈值的增大，保留下来的具有显著因果关系的边减少。本章选择 2014 年 5 月 6 号全路网的交通速度数据集，计算任意两条路段之间随时间推移的 传递熵和因果关系系数。可以按上文提到的显著性计算方法，求得扰乱序列的传递 熵差的均值  = 0.0151，标准差是   = 0.0116 ，计算阈值为  =  + 3   0.05 。 为了显示不同阈值对于因果关系图的影响，设置不同的阈值  ，统计总边数如表 4.2 所示。

表 4.2 因果关系图总边数随阈值的变化图边数统计



总边数

0.01

5081635

0.05

184323

0.06

39318

0.09

33

以路段 r223 为例，同样以 2014 年 5 月 6 号的数据为基础，计算在不同延迟系
 数设置下，路段 r223 向其他路段全天传递熵均值：TEr223 = TEi→ j t 。在设置不同
延迟系数 h 的条件下，选择 TEr223 最大的前 10 条路段，即受t 路段 r223 的交通状态影 响较大的路段，如表 4.3 所示。

69

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘

表 4.3 不同时间延迟系数下的受路段 r223 交通状态影响较大的路段编号

排序

h=1

h=2

h=3

h=4

1

348

348

348

348

2

255

255

3

16

3

6

3

84

255

4

61

61

255

290

5

3

80

7

7

6

7

6

13

174

7

290

174

206

206

8

88

290

290

136

9

193

88

88

189

10

174

91

80

3

4.4.2 动态因果关系分析
考虑计算能力和因果关系强度，三个参数设置为 k = 1,l = 1, h = 1。采用时间窗
口概率密度的方法计算路段之间传递熵变化的时序曲线。选择一阶相邻两条路段 r220 , r223 ，计算一天的传递熵值 TEr220 →r223 和 TEr223→r220 ，如图 4.5 所示。相对方向传递 熵的差值随时间变化如图 4.6 所示。因果关系系数随时间变化如图 4.7 所示。可以 看出一阶相邻路段之间的传递熵随时间的推移，变动较大。不同时段的信息传递的 方向和大小差异较大。比如 10:00-18:00 之间信息的传递方向主要是 r223 → r220 ，而 18:00-21:00 之间信息传递方向主要是 r220 → r223 。

图4.5 不同方向的传递熵值变化 70

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
图4.6 相对方向传递熵的差值变化
图4.7 因果关系系数变化 选择 2014 年 5 月 6 号这一天全路网 432 条路段，计算所有路段之间相对方向 传递熵的差值，取值分布如图 4.8 所示。因果关系系数分布较为集中如图 4.9 所示。
图4.8 相对方向传递熵的差值分布 71

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘

图4.9 因果关系系数分布

4.4.3 城市路网时空因果关系分析

根据以上分析可以看出路段之间的传递熵随着时间和空间的变化，波动较大， 也反映出交通状态之间的信息传递量在时空维度上变化较大。每个源节点是潜在 的原因路段。为了提取路网中对其他路段交通状态影响较大的路段，定义影响系数 和被影响系数，提取不同时段的关键路段。把路段 i 向剩余所有路段的传递熵之和 定义为路段 i 的影响系数 Rout (I) ，可以用来描述路段 i 对于其他路段的影响。同理， 把其他所有路段向路段 i 的传递熵之和定义为被影响系数 Rin (I) ，用来刻画其他路 段的交通状态对于目标路段的影响作用，即：

 Rout (I) = TEi→ j j

（4-20）

 Rin (I) = TE j→i j

（4-21）

分别计算早高峰、平峰及晚高峰的三个时段的影响系数 Rout (I) 和被影响系数 Rin (I) 。选择 2014 年 5 月 6 日全路网的所有路段为研究对象，识别不同时段的路 网关键路段。每条路段三个时段对应影响系数 Rout (I) 和被影响系数 Rin (I) 如图 4.10 所示，用圆形气泡表示路段，气泡的大小代表路段的平均速度， Rout (I) 和 Rin (I) 确 定气泡的位置。 Rout (I) 和 Rin (I) 可以定量地描述路网上任意一条路段的交通状态对 其他路段的影响程度和被影响程度。可以看出早高峰时段，路段的分布较为分散； 平峰期和晚高峰期，路段的分布相似，主要分布在紫色线上方。分布在绿色线上方 的路段在该时段的交通状态更容易影响其他路段；分布在紫色线下方的路段在该 时段的交通状态更容易受其他路段的影响。表 4.4 罗列了不同时段最容易受其他路 段交通状态影响和最容易影响其他路段交通状态的路段，在路网上的位置分布如 图 4.11 所示，对外影响作用大的路段主要分布在中西部地区。

72

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘

(a) 早高峰路段分布

(b) 平峰路段分布

(c) 晚高峰路段分布

图4.10 路段的影响系数和被影响系数分布

表 4.4 不同时段的关键路段编号

容易受影响的路段 对外影响作用大的路段

早高峰 35，328，70

123，36，30

平峰 341，323，251

22，348，61

晚高峰 429，318，95

16，226，224

73

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
(a) 容易受影响的路段
(b) 对外影响作用大的路段 图4.11 关键路段的空间分布 值得注意的是虽然任意两条路段的交通状态都会存在一定程度的关联性，计 算的传递熵都是非零的，但并不是所有的路段交通状态之间都存在显著的因果影 响关系。因此，本文对基于路网上的 432 条路段交通状态时间序列计算的传递熵
做进一步分析，按上文提到的显著性计算方法，阈值设为 = 0.05 。对于任意两条 路段之间的传递熵，按照式（4-18），计算因果关系矩阵 W。
为了评价任意一条路段对于其他路段的显著因果影响关系，把对目标路段 i 的 交通状态有显著因果影响的路段数目定义为输入度 Din (i) ；把目标路段 i 对其他路
74

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘

段有显著因果影响的数目定义为输出度 Dout (i) ，计算公式如下：
 Din (i) = wji j

（4-22）

 Dout (i) = wij j

（4-23）

分别计算 2014 年 5 月 6 号早高峰 7:00-10:00、平峰 13:00-16:00 及晚高峰 17:00-

20:00 时段每条路段对应的输入度总和 SumDin (i) 和输出度总和 SumDout (i) 。

  SumDin (i) =

wtji

tj

（4-24）

  SumDout (i) =

witj

tj

（4-25）

三个时段输入度和输出度总和分布如图 4.12 所示，输出度分布比输入度分布 更集中。整体上，早高峰时段路网上输入度大于晚高峰时段，平峰时段最小且分散。 在拥堵状态下，路段受其他路段交通状态的影响更明显。类似地，早高峰时段路网 上输出度大于晚高峰和平峰时段。在拥堵状态下，路段对其他路段交通状态的影响 更明显。因此高峰期间路段交通状态的相互影响更为明显。

(a)

(b) 75

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘 (c) (d) (e) 76

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
(f) 图4.12 不同时段输入度和输出度总和分布图 使用 NetDraw 软件分别对早高峰 8:30 时刻、平峰 13:30 及晚高峰 18:30 的全 路网所有路段输出度和输入度进行可视化展示，分析典型时段路段输入度和输出 度的空间分布特征。绘图需要的输入文件有：路段中心坐标、因果关系矩阵 W。如 图 4.13 所示，蓝色圆圈的大小代表节点输出度，圆圈直径越大，输出度越大，代 表该路段对路网其他路段交通状态的影响越大；圆圈越小，节点输出度越小，代表 该路段对路网其他路段交通状态的影响越小。蓝色圆圈外围的深灰色箭头代表节 点的输入度，箭头越密集，输入度越大，代表受路网其他路段交通状态的影响越大。 东部外环边区域相对其他区域圆圈较小，尤其是平峰期，表明此区域的路段对 路网其他路段的影响关系不明显，呈现较弱的关联性。一方面东部区域出行量较小， 交通通畅，出行模式独特，对其他区域的影响过小；另一方面，东部区域开发较晚， 城市功能单一，区域路网可达性较低，道路网络设计有待进一步改善。 不同时段圆圈大小分布和箭头密集程度分布差异显著，代表路段输出度和输 入度不同的空间分布。高峰时段路网上路段的输出度和输入度整体上大于平峰时 段。从图 4.13(a)可以看出早高峰时段输出度大的路段主要集中在干道交汇处，大 量的车流在该区域汇合，包括城市南北方向主干道南北高架路、东西方向主干道延 安高架路、内环路段、南部中环路等路段。晚高峰时段输出度大的路段主要集中在 东部内环高架上。快速路的进口和出口是潜在的交通拥堵瓶颈。这些输出度大的关 键路段上的交通流量主要来自于不同上游路段的车流量，同时与多个下游方向的 路段连通，承担大量车流的汇合和分散，因此能够影响到较大范围的路网交通状态。 对输出度高的路段对应的空间位置和结构进行可视化，以早高峰 8:30 时刻的
输出度大的路段 r302 , r391, r286 , r181 为例，在路网上的分布如图 4.14(a)所示。路段具体 的空间位置和结构如图 4.14(b)- (e)所示，其中黄色标记是识别出来的关键路段，绿
77

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
色标记是进出口匝道或者立交匝道，可以看出路段 r302 , r391, r286 均位于车流的交汇或 分散处，承担着大量车辆的汇合和分流功能，因此对路网上其他路段的影响较大， 辐射范围较广，是路网早高峰的关键路段。路段 r181 虽然是快速路的中间路段，没 有复杂的交汇车流，但是其位于上海市东西方向的主要通道延安高架上，承担着东 西方向主要的交通流量，也容易发生拥堵，在路网上对其他路段的影响作用明显。 采用输出度的方法识别路网关键路段的结果和路段的空间结构及功能一致，进一 步证实了传递熵是一种科学的量化路网交通时空状态之间影响关系的方法，也是 一种有效的路网关键路段识别方法。

(a)早高峰

(b) 平峰

(c)晚高峰 图4.13 全路网所有路段输出度和输入度进行可视化
78

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
(a) (b) (c) 79

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
(d)
(e) 图 4.14 关键路段的空间位置及结构
4.5 本章小结
本章提出了一种基于传递熵算法的城市路网交通状态时空因果关系挖掘方法。 采用核密度估计的方法计算任意两条路段交通流时间序列之间的传递熵，适用于 非高斯分布交通流数据。为了描述变量之间信息传递量随时间的动态变化，采用滑 动窗口技术，计算得到传递熵矩阵，绘制传递熵时序变化曲线，可以反映交通状态 演变过程中信息传递量的动态变化。使用因果显著性判断的方法，建立具有显著因 果关系的动态时空因果关系图。定义影响系数和被影响系数、输出度和输入度指标， 从信息的传递量角度，能有效评价路网各路段之间的相互影响关系，以及路网上不 同路段的重要程度，同时也为路网关键路段识别提供了一个新思路。
研究结果表明：不同方向的传递熵值不同，具有非对称特性，且随时间变化明 显；高峰时段输出度和输入度整体上大于平峰时段，路段交通状态之间的信息传递 量更大，因果关联系更明显。早高峰输出度大的路段集中在车流的交汇或分散处， 承担着大量车辆的汇合和分流功能，因此对路网上其他路段的影响较大，辐射范围 较广。东部外环边区域圆圈较小，尤其是平峰期，表明此区域的路段对路网其他路
80

第 4 章 基于传递熵算法的交通状态时空因果关系挖掘
段的影响关系不明显，关联性较弱。 模型没有考虑空间距离和拓扑连接关系，完全从数据驱动的角度分析路网交
通状态时变的因果关系。在未来的交通状态因果关系挖掘的研究工作中，可以进一 步丰富路网交通状态数据源，考虑包含不同等级道路的全路网状态，以及路网的空 间拓扑邻接关系，建立更为精细的时空因果关系挖掘模型，对不同等级的路段在路 网上的影响作用进行量化。
81

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别
第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别
5.1 本章引言
在城市道路环境中经常会有这种直观驾驶经验：前方看似没有交通事故、施工 车道等影响，道路突然堵塞，车辆缓慢前行或停滞不前，后方车辆对应的降低速度 前行或停止，一段时间后道路又逐渐顺畅起来，车辆恢复正常速度前行，上游交通 流也逐渐从停滞状态变为畅通状态。这些直观的驾驶经验反映的是交通拥堵的形 成、传播及消散过程。为了理清拥堵产生及传播的原因，交通拥堵传播模式一直以 来都是交通工程领域非常重要的研究问题。一方面是由于交通拥堵的发生具有随 机性，受事故、天气、节假日等因素的影响较为明显；另一方面，不同时段不同区 域的交通出行需求时空波动性较强，进而导致交通拥堵状态在路网上的传播模式 非常复杂。
目前较多的研究采用基于交通流理论的机理模型，但由于模型的复杂性和有 限的计算能力，该方法适合研究规范化小范围的路网交通拥堵传播过程。随着交通 时空数据的大量积累和智能计算的快速发展，基于时空数据挖掘的交通拥堵状态 传播模式识别，作为一种新兴的交通拥堵传播研究方法，成为一个较为前沿的研究 热点，引起很多学者的关注。如何使用数据挖掘模型提取全路网范围内交通拥堵状 态的传播模式对于解决城市交通拥堵问题有重要的研究意义。
基于数据挖掘的交通拥堵状态传播研究是从历史数据中识别频繁出现的拥堵 传播模式，主要分为两类：一类是直接利用关联规则挖掘思想分析路网交通拥堵状 态的时空关联性，不考虑拥堵事件在时间的先后顺序以及在空间上的临近程度，提 取拥堵事件之间频繁发生的关联规则；另一类是考虑拥堵状态发生先后顺序，以及 路段在路网上的空间拓扑邻接关系，通过判断拥堵事件是否满足时空约束条件，提 取交通拥堵传播路径，即拥堵传播模式。实际上，交通拥堵状态之间不仅具有时空 相关性，而且存在一定的因果关联性，但是目前在拥堵传播模式识别的研究中考虑 拥堵事件之间因果相互关系的研究比较缺乏，主要是依据交通拥堵发生的先后顺 序这种简单的先验知识方式来定义，尚未有明确量化拥堵状态之间因果关系强度 的研究出现。
时空网络是拓扑结构和参数随时间变化的空间网络，在交通规划、路径寻优、 传感器数据分析领域起着重要的作用[169]。城市路网上交通状态的演化过程可视为 一个复杂动态的时空网络。本章提出一个基于时空因果关系挖掘的频繁交通拥堵
82

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别
传播模式识别方法。基于实际观测交通流检测器数据，构建交通时空网络，着重考 虑了拥堵事件之间的因果关联性，分析路段之间的动态拥堵状态传播关系，提取拥 堵传播的频繁时空传播模式。需要重点解决以下三个问题：（1）如何定义路网拥堵 状态？（2）如何量化路段交通拥堵状态之间的时空因果关系？（3）如何识别拥堵 状态传播的频繁模式？为了解决以上三个关键问题，本章提出了一个三阶段的交 通拥堵状态传播模式提取方法，以多条路段构成的城市道路网络为研究对象，每条 路段交通状态作为特征，研究技术路线如图 5.1 所示。
首先，为了更为科学地评估路网上的交通拥堵状态，引入交通拥堵系数，从海 量的交通状态时间序列数据中提取不同路段的交通拥堵事件，建立时空拥堵状态 矩阵，创建交通拥堵事件数据表。
其次，判断拥堵事件之间是否具备因果关联关系，对于满足因果关系强度的交 通拥堵事件对建立因果关联关系，构建路网交通拥堵状态时空传播图。采用传递熵 模型计算任意相邻的两条路段之间交通状态因果关联性强度，建立时空因果关联 连接矩阵。基于提取的交通拥堵状态矩阵和时空因果关系连接矩阵，以及考虑拥堵 事件在时间上的连续性和空间拓扑上的连通性约束，构建路网交通拥堵状态时空 传播图，并创建时空网络图数据库。
最后，基于路网交通拥堵状态时空传播图集，采用频繁子图挖掘的方法，提取 路网上一定时期内频繁发生的拥堵传播模式，挖掘相邻路段拥堵状态之间的强关 联规则，识别潜在的拥堵传播关键路段及对应的传播路径，并进行可视化展示，分 析拥堵传播的过程和拥堵状态的时空因果关系。通过放宽拥堵状态发生的时间和 空间约束条件，识别潜在的频繁拥堵状态关联模式。
本研究旨在提取频繁出现的交通拥堵传播模式，呈现交通拥堵从瓶颈路段向 空间邻近路段传播的过程，挖掘潜在的拥堵传播规律，识别路网规划不合理之处， 为治理交通拥堵提供决策支持，同时也能为预测拥堵传播路径提供研究基础。相比 于已有的研究，该框架对交通拥堵状态发生时间、空间及因果关联性有严格的限制， 能够有效地剔除冗余的边，减少了冗余子图的生成，提取出来的频繁拥堵传播子模 式能代表路网上拥堵状态的传播特征。该研究框架还可以应用于其他与时空网络 相关的问题，例如社交网络、空气污染、气候变化等等。值得注意的是当面对一个 大规模的城市路网，该方法需要从海量的全路网交通状态时空数据集中提取拥堵 事件，量化多路段交通状态时空因果关系强度，遍历全路网所有拥堵事件，提取交 通拥堵传播模式，计算复杂度高，需要大量的计算资源。
83

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别

图5.1 研究技术路线

5.2 路网交通拥堵状态时空传播图构建

5.2.1 交通拥堵指数

考虑每条路段具有不同特征包括路段长度、车道数、速度限制、地理位置等等，

提出以路段平均速度为核心的标准化交通拥堵指数（TCI, Traffic Congestion Index）

Cit 来代表每条路段 i 在时刻 t 的拥堵状况，计算如下：

Cit

=

vmax i

-

vit

vmax i

-

vmin i

（5-1）

式中

vit

是路段

i

在时刻

t

的速度；vimax

和

v min i

分别是在经数据预处理后的历史数据集

中，路段 i 对应的最大速度和最小速度。速度越大，拥堵指数越小，交通越畅通；

反之速度越小，拥堵指数越大，交通越拥堵。利用该指数能够对城市路网交通状态

进行更为科学的量化，更加准确地反映城市路网交通拥堵状态。

84

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别
5.2.2 时空拥堵状态矩阵

采用每条路段拥堵指数的第 n 百分位数作为判定该路段交通状态是否拥堵的

阈值

C threshold i

。本文设定拥堵指数第

70

百分位数（70th）作为拥堵指数阈值

C 70th i

，

即如果 Cit >Ci70th ，则路段 i 在时刻 t 处于拥堵状态，定义为交通拥堵事件（Traffic

Congestion event, TC）。每个拥堵事件TCit 由 t, ri ,Cit 三个元素表示，其中 t 代表拥堵

事件发生时间，ri 是拥堵事件发生路段，Cit 是拥堵事件对应的拥堵指数。所有的拥

堵事件TCit 构成了交通拥堵事件数据库。

拥堵阈值

C threshold i

代表少有

70％的数据项小于或等于这个值，有

30％的数据项

大于这个值。以路段 r181 为例，计算两个月的交通拥堵指数，如图 5.2 所示，每个

点代表当前时间槽的对应拥堵指数，红色水平线代表该路段的拥堵阈值。

图5.2 路段 r181 的交通拥堵指数变化

为了后续建模的需求，根据拥堵指数及其阈值定义路网时空交通拥堵状态二

维矩阵

TC

。若

Cit

>C threshold i

，即 t 时刻路段 ri 发生拥堵，拥堵矩阵对应的元素TCi,t

= 1，

否则 TCi,t = 0 ，即：

TC

=

TTCCitit

= 1, Cit = 0, Cit

>C threshold i
 C threshold i

（5-2）

本文的路网规模是 432 条路段，数据采集天数 60 天，时段为 6:00-22:00（时 间间隔 10min），因此TC 是一个维度是 4325760 的时空拥堵矩阵。以路段 r1 ~ r8 在 2014 年 5 月 6 日上午 7:00-8:00 为例，计算得到的时空交通拥堵状态矩阵如下：

85

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别

1 1 0 1 0 1 0 0

1 1 0 1 0 1 1 1

1 1 0 1 1 1 1 1 TC = 1 1 0 1 0 1 1 1

1 0 0 1 0 1 1 1 





1 1 0 1 0 1 1 1 

（5-3）

以 2014 年 5 月 6 日为例，全路网拥堵路段数量随时间的变化曲线如图 5.3 所 示。 不同时间发生拥堵的路段数不同，高峰期的路段数要大于平峰期。

图5.3 路网拥堵路段数量随时间的变化

5.2.3 路网空间邻接矩阵

为了描述交通拥堵状态沿路网空间拓扑结构传播过程，需要建立路段的空间 邻接矩阵T ，表征任意两个路段之间的空间相邻性和方向性。考虑交通拥堵状态的 后向传播特性，按以下方式定义一阶空间邻接矩阵T1 ：若路段 ri 和 rj 在路网空间上 一阶相邻，且 rj 是路段 ri 的上游路段，则矩阵的元素Ti, j = 1，否则 Ti, j =0 ，即：

T1

=

Ti, Ti,

j j

=1, =0,

路段rj是路段ri一阶连通的上游路段 其它

（5-4）

同理定义 k 阶空间邻接矩阵Tk ：若路段 ri 和 rj 在路网空间上 k 阶相邻，且 rj 是路

段 ri 的上游路段，则矩阵的元素Ti, j = 1，否则 Ti, j =0 ，即：

Tk

=

TTii

, ,

j j

=1, =0,

路段rj是路段ri k 阶连通的上游路段 其它

（5-5）

考虑路段在一定空间范围内是否邻近，需要定义 k 阶以内空间邻接矩阵T1~k ： 若路段 ri 和 rj 在路网空间上 k 阶以内相邻，且 rj 是路段 ri 的上游路段，则矩阵的元素

86

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别

Ti, j = 1，否则 Ti, j =0 。 T1~k 可以基于空间邻接矩阵 T1,T2 , Tk−1,Tk 计算得到，每个元

素

T 1~k i, j

与各个矩阵对应位置上元素取值有关，定义方式如下：

T1~k

=

Ti1, ~j k =1,  Ti1, ~j k =0,

 Tk k 1 i, j

0

 Tk k 1 i, j

=

0

（5-6）

图 5.4 是一个由 6 条路段组成的简单路网示意图，圆圈代表路段，箭头代表交

通流的方向，例如路段 r1 是路段 r2 的上游路段。对应的一阶、二阶、三阶空间邻接 矩阵T1,T2 ,T3 分别是：

0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

1 0 0 0 1 0

0 0 0 0 0 0

0 0 0 0 0 0

0 1 0 0 0 1 1 0 0 0 1 0 0 0 0 0 0 0

T1 = 0

0

1

0

0

0

 

,

T2

=

0

1

0

0

0

1

 

,

T 3

=

1

0

0

0

1

0 （5-7）

0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0





0 0 0 0 0 0





0 0 0 0 0 0





0 0 0 0 0 0

基于式（5-6）计算 3 阶以内空间邻接矩阵 T1~3 为：

0 0 0 0 0 0

1 0 0 0 1 0

1 1 0 0 1 1 T1~3 = 1 1 1 0 1 1

0 0 0 0 0 0





0 0 0 0 0 0

（5-8）

图 5.4 简单路网示意图 5.2.4 时空因果关系连接矩阵
本章采用传递熵算法计算城市路网交通复杂系统的交通状态时间序列之间的 因果相互作用关系，量化路段之间交通状态的信息传递量，提取路网因果关联性的
87

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别
时空特征。传递熵是非负的，不仅可以表征不同路段之间信息传递的方向，而且可 以动态地描述因果关联性强度变化，描述路网时空交通状态的非线性特征。对于任
意两条相邻的路段 ra 和 rb ，路段 ra → rb 的传递熵 TEra →rb 表示路段 ra 向路段 rb 的传
递信息量的大小，衡量路段 ra 的交通状态对于路段 rb 不确定性大小的改变，反应两 条路段交通状态时间序列之间的耦合关系，可以作为计算因果关联性的指标。
已知路网由 n 条路段 r1, r2, rn 构成，每个路段的交通状态设为变量Vi ，则全路 网对应的变量为V1,V2, Vn 。交通状态时空因果图模型是由节点和有向边构成，其 中节点代表路段，有向边代表其连接的两条路段交通状态之间存在显著的因果关 联关系。计算路网上任意两条路段上随着滑动窗口从首到尾移动的不同方向传递
熵，设置时间延迟系数 h = 1，并求取对应的因果关系系数 it, j ，设置因果关系强度 阈值  ，计算时空因果关系连接矩阵W t ：

Wt

=



wt i,

j

=1,

 

wt i,

j

=0,

TE t i→ j

 TEt 且t  

j→i

i,j

其它

（5-9）

真实的路网时空交通状态一直都随着时间变化，因此每个时刻的因果关系连

接矩阵W t 都不同，形成时变的交通状态时空因果关系图，如图 5.5 所示。对于任

意两个相邻路段

ri

和

rj

，ri

是

rj

的下游路段，如果

TEri

→rj－TErj

＞0
→ri

，则

Vi

是上级原

因变量，Vj 则是下级影响变量，时空因果关系图结构中有向边从路段 ri 指向路段 rj ；

如果 TEri →rj－TErj →ri＜0 ，Vi 是下级影响变量，Vj 则是上级原因变量，与拥堵向上游

传播的方向不一致，不设置有向边。

图5.5 时变的交通状态时空因果关系示意图
以路段 r1 ~ r8 在 2014 年 5 月 6 日上午 8:00 为例，计算得到传递熵矩阵为，
88

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别

0

0.055

0.038

TE

=

0.020  0.051



0.039

0.017 

0.036

0.001 0
0.023 0.004 0.042 0.012 0.017 0.043

0.022 0.042
0 0.014 0.030 0.024 0.017 0.041

0.021 0.040 0.031
0 0.058 0.023 0.017 0.039

0.017 0.045 0.016 0.020
0 0.033 0.015 0.035

0.021 0.029 0.022 0.007 0.056
0 0.017 0.043

0.022 0.056 0.038 0.021 0.047 0.040
0 0.024

0.022 0.041 0.023 0.013 0.034
 0.022 0.004
 0 

按式（4-15）计算因果关系系数矩阵为：

0

0

0 0.001 0

0 0.005 0

0.054 0 0.019 0.036 0.003 0.017 0.039 0

0.016 0

0 0.017 0

0 0.021 0

ρ

=

 

0

0.034

0 0

0

0

0.014 0.028

0 0

0 0.004 0 0.023 0.032 0





0

0 0.002 0.016 0

0 0.023 0

 

0

0

0

0

0

0

0 0

0.014 0.002 0.018 0.026 0.001 0.021 0.020 0

因果关系阈值设为  = 0.02 ，则按照式（5-9）计算时空因果关系连接矩阵，如 下：

0 0 0 0 0 0 0 0

1 0 0 1 0 0 1 0

0 0 0 0 0 0 1 0

W

t =8:00

0 1

0 0

0 0

0 1

0 0

0 1

0 1

0 0





0 0 0 0 0 0 1 0

0 0 0 0 0 0 0 0





0 0 0 1 0 1 1 0

5.2.5 交通拥堵状态时空传播图
交通拥堵传播模式是交通拥堵状态在时空上的潜在频繁传播规律，体现在路 网上则是交通拥堵状态的频繁传播路径。Nguyen 等[75]同时提取了拥堵前向传播和 后向传播模式，但从车流波的角度，交通拥堵是沿着路网拓扑结构朝上游方向扩散， 需要考虑网络的拓扑结构约束，且属于后向传播。本章提取的是交通拥堵状态后向 传播模式，即交通拥堵状态从下游路段向上游路段传播。
Xiong 等 [73] 采 用 了 一 个 定 义 交 通 拥 堵 状 态 时 空 传 播 图 （ Spatio-temporal

89

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别
Propagation Graph for Traffic Congestion, STPG）方法：每个节点代表一次路段拥堵 事件，描述的是交通拥堵从根路段（Root Segment）在连续时间内传递到邻近路段 的传播模式。拥堵状态传播路径不仅要保证前后两条路段在空间上一阶连通，而且 要保证前后两个拥堵事件前后发生时间是连续的。如图 5.6 所示，不同颜色代表路 段在不同时刻发生的交通拥堵，展示了拥堵状态如何从根路段传播到邻近的路段。 路段 ra 在 8:00 发生拥堵，随后路段 rb 在 8:10 发生拥堵，交通拥堵从路段 ra 沿上游 方向传播到路段 rb 。同理，交通拥堵在 8:20 从路段 rb 传播到路段 rc ，在 8:30 从路 段 rc 传播到路段 rd 。可以认为 ra → rb → rc → rd 早高峰的路网交通拥堵传播有向图， 如果其频繁发生，可认为是交通拥堵状态频繁传播模式。
图5.6 交通拥堵状态时空传播示意图
若按照以上这种简单的方法定义交通拥堵状态传播图，虽然能保证拥堵路段 在空间上是连通的且拥堵发生时间是连续的，但是拥堵事件先后发生并不能代表 两个拥堵事件具备显著的因果关系，因此提取出来的拥堵状态时空传播图可能会 产生很多冗余的边，一方面会降低后续频繁子图挖掘的运算效率，另一方面提取频 繁拥堵传播模式不能真正意义上反映拥堵状态的传播特征。本文在此基础上采用 传递熵算法来定义交通拥堵状态之间的因果关系强度，能有效减少冗余的边，构建 基于拥堵状态发生时间的连续性、路段空间拓扑上的连通性以及因果关系强度的 交通拥堵状态时空传播图，提高了拥堵传播模型的可解释性。具体算法如下算法 5.1 所示。
算法 5.1 需要判断当前拥堵事件TC 能否被插入子图 g 中，需要判断当前子图 g 的某个节点对应的拥堵事件 TC ' 能否是拥堵事件TC 对应节点的父节点，要满足 以下三个条件：1）时间上的连续性，即 t = t '+1， t ' 是TC ' 发生的时间，t 是TC 发
生的时间；2）空间上的邻近连通性，路网本身存在拓扑连接关系，假设交通状态 是沿着网络拓扑传播，需要判断路段 r 是否与路段 r ' 上游一阶相邻的路段，其中 r '
90

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别
是TC ' 发生的路段，r 是TC 发生的路段；3）拥堵事件TC 和TC ' 之间的因果关系强 度要超过指定阈值 r'→r   。每个拥堵事件在因果关系图中只出现一次。
算法5.1 创建交通拥堵状态时空传播图 G

输入：按式（5-2）确定时空拥堵事件集TC ，按发生时间的先后进行排序。每个时间槽
对应路网上不同路段发生的拥堵事件。
输出：时空因果关系图集 G ，每个图代表一种交通拥堵时空传播模式。

设初始图集G   for 对于每个拥堵事件TC 执行以下操作：
预设图集 M  , N   ； for每个子图 g G
判断当前拥堵事件TC 能否被插入当前子图 g 中；
if 可以插入，
M Mg

else
N Ng

if M =  ，
用拥堵事件TC 作为一个节点，建立一个新图 g ' ； G Ng'

else
把当前拥堵事件TC 插入已有的图集 M 的一个图里，组合得到新图 g ' ； G Ng'

返回 G

注： M 图集是为了连接与已有图集存在子父节点关系的图， 临时性保存，N

图集是保存完备的传播子图[45]。

基于路网时空交通拥堵状态矩阵TC 、一阶空间邻接矩阵T1 以及时空因果关系
连接矩阵W t ，按以下方式判断当前拥堵事件TC 能否被插入子图 g ：对于任何一个

拥堵事件TCit = 1，首先，基于邻接关系矩阵T1 搜索路段 ri 的一阶连通的上游路段 rj 。

基于路网时空交通拥堵状态矩阵TC ，判断 rj 路段在 t +1是否发生拥堵事件，如果

路段

j

在t +1

时刻发生拥堵事件

TC

t +1 j

= 1，且两条路段

i,

j

，在 t

时刻路段交通状

态时空因果连接矩阵元素

wt i,j

为

1，则两个拥堵事件 TCit

和

TC

t +1 j

存在时空因果关联

91

第 5 章 基于时空因果关系的交通拥堵状态频繁传播模式识别

性，可认为路段 i 是路段 j 根路段，在拥堵因果传播图上则体现为拥堵事件 TCit 是

拥堵事件

TC

t +1 j

的父节点。在算法

5.1

中，如果子图 g

包含拥堵事件 TCit ，即当前

拥堵事件

TC

t +1 j

可以被插入子图

g

中。为了方便描述拥堵事件之间的因果关联性，

设拥堵事件时空关联矩阵 M ，如式（5-10）所示：

M

=



mt i,

j

=1,

mit,j =0,

TCit

=

1,

TC

t +1 j

=

1,

wt i,

j

=1且Ti,

j

=1

其它

（5-10）

式中 mt 取值为 1 的个数代表交通拥堵传播事件对的个数。 i, j

5.3 频繁交通拥堵传播模式挖掘

5.3.1 频繁子图挖掘算法

基于图结构数据的运算基础是统计和联结逻辑关系。频繁子图挖掘算法 （Frequent Subgraph Mining，FSM）是从一组图数据集中识别出现频率高于设定阈 值的子结构的方法，其经典的应用场景“购物篮”分析方法，能够从销售数据中识 别出顾客频繁一起购买的商品[71]。交通拥堵状态在路网上的频繁传播模式属于频 繁序列模式，有时间上的先后关系，与数据挖掘领域中的频繁项集挖掘问题有区别。 本节基于 5.4.1 部分提取的交通拥堵状态时空传播图集识别拥堵传播频繁子图模式， 不仅能够呈现频繁出现的时空拥堵状态交互作用，而且能够发现路网设计潜在的 瓶颈分布。为了更好地解释算法的执行过程，结合本章的交通拥堵传播频繁模式识 别模型，对频繁子图挖掘基本概念进行解释：
1）子图：对于图 G '=V ', E ' 和 G=V , E ，V ' 和V 分别是图 G ' 和 G 的顶点集，
E 和 E ' 分别是图 G ' 和 G 的边集，若顶点集V ' 是V 的子集，边集 E 是边 E ' 的子集， 图 G ' 是图 G 的子图，记做 G '  G 。
2）支持度：设图的集合为 G = G1,G2 ,Gn  ，传统的频繁子图挖掘模型的支持
度是指包含子图 g 的所有图所占的百分比，即：

Support(g) = G g  Gi ,Gi G
G

（5-11）

由于本研究的子图挖掘模型带有时间序列的特征，每个子图每天最多发生一
次，因此将式（5-11）的分母替换为实验数据的总天数 N ，即：

92

