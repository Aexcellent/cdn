总第 339 期 2018 年第 1 期

计算机与数字工程 Compu计te算r &机D与ig数ita字l E工ng程ineering

Vol. 46 No. 1 149

一种基于微服务架构的业务系统设计与实现∗

洪华军 吴建波 冷文浩
（中国船舶科学研究中心软件工程技术中心 无锡 214082）
摘 要 针对当前企业信息化的发展过程中，应用系统越来越笨重和庞大，难以维护和更新的问题，引入微服务架构。 首先介绍了微服务架构原理，论述了微服务架构优势，并对微服务架构不足提出了应对措施。针对当前开发和维护的综合 业务管理系统，根据实际业务情况，采用微服务架构，划分微服务边界，选用 Spring Cloud 开源微服务框架，对其进行总体架 构设计和功能结构设计，并进行程序实现。为企业信息化遇到的问题提出了一种解决方案。
关键词 微服务架构；企业信息化 中图分类号 TP311 DOI：10. 3969/j. issn. 1672-9722. 2018. 01. 032
Business System Design and Implementation Based on Microservice Architecture

HONG Huajun WU Jianbo LENG Wenhao （Software Engineering and Technology Center，China Ship Science Research Center，Wuxi 214082）

Abstract As the development of enterprise information，the business system is very cumbersome and bulky，and difficult to maintain and update. Then microservices architecture is introducted to solve these problems. First，this paper introduces the princi⁃ ple of microservices architecture，discusses the advantages，puts forward the countermeasures to the microservices architecture. Then uses the microservices architecture to develop and maintain the integrated business management system. It designs the overall architecture and functional structure and carries on the program implementation by giving the microservices boundary definition，us⁃ ing the open-source microservices framework of Spring Cloud. It may be a solution to solve the problems of enterprise information.
Key Words microservices architecture，enterprise information Class Number TP311

1 引言
随着企业信息化的发展，应用系统的数量、规 模和复杂度不断增长，应用实现越来越复杂，代码 规模越来越大，系统变得更加笨重和庞大，导致应 用难以维护和更新。原有的单一应用架构，由于逻 辑过于耦合已无法应对；垂直应用架构，由于应用 之间交互越来越多，越来越复杂已不再适应；分布 式服务架构，由于服务越来越多，容量的评估，小服 务资源的浪费等问题逐渐显现。
针对当前企业信息化的现状，对系统的开发和 部署提出了新的挑战，对企业应用架构的高效性和 扩展性提出了更高的要求［1］。微服务架构的出现，

有效解决了当前企业信息化面临的一系列问题。 可以通过微服务架构将复杂应用进行服务化切分， 把一个大而复杂的问题化解为多个小而简单的问 题，使用一套小服务来开发单个应用，实现微小服 务功能。服务之间以轻量级通信的协调机制，以业 务为中心，通过契约来约定依赖，构建起独立的自 动化运行机制，以实现集中式服务管理［2］。
2 微服务原理
2.1 微服务架构定义 微 服 务［3］是 一 些 协 同 工 作 的 小 而 自 治 的 服
务。它具有高内聚性和高自治性。微服务根据业 务的边界来确定服务的边界。同时，它也是一个独

∗ 收稿日期：2017 年 7 月 4 日，修回日期：2017 年 8 月 23 日 作者简介：洪华军，男，硕士，工程师，研究方向：企业信息化，大数据，软件架构。吴建波，男，硕士，高级工程师，研究 方向：企业信息化，数据工程，软件顶层设计。冷文浩，男，博士，研究员，研究方向：CAE，企业信息化，数据工程。

150

洪华军等：一种基于微服务架构的业务系统设计与实现

第 46 卷

立的实体，可以独立地部署在 PaaS 上，也可以作为 一个操作系统进程存在。服务之间均通过网络调 用进行通信，从而加强服务之间的隔离性，避免紧 耦合［3］。
微服务架构是一种架构模式，它将单一应用程 序划分成一组小的服务，服务之间相互协调、相互 配合。每个服务运行在其独立的进程中，服务与服 务间采用轻量级的通信机制相互沟通。每个服务 都围绕着具体业务进行构建，并且能够被独立地部 署到生产环境、类生产环境等。另外，应尽量避免 统一的、集中式的服务管理机制，对具体的一个服 务而言，应根据业务上下文，选择合适的语言，工具 对其进行构建［4］。 2.2 微服务架构优势
微服务架构模式有众多优势［4~5］。 1）组件化 微服务可以被认为是一种组件。它与传统组 件方式最大的区别是，传统组件将应用模块化并为 其构建相对独立的单元。隔离独立的部分或抽取 公 用 的 部 分 ，构 建 共 享 库 ，达 到 解 耦 和 复 用 的 效 果。而微服务架构将系统以组件化的方式分解为 多个服务，服务之间相对独立且松耦合，单一功能 的改变只需要重新构建部署相应的服务。 2）独立部署 由于微服务具备独立的运行进程，所以每个微 服务也可以独立部署。当某个微服务发生变更时 无 需 编 译 、部 署 整 个 应 用 ，大 大 缩 短 应 用 交 付 周 期。微服务架构模式使得持续化部署成为可能。 3）降低复杂度 微服务架构通过分解单体式应用为多个服务 方法，让复杂性可控，避免不必要的数据孤岛。在 功能不变的情况下，应用被分解为多个可管理的服 务，通过微服务架构模式，让复杂的功能，通过模块 化的方式呈现，给采用单体应用编码方式难以实现 的功能提供模块化的解决方案，让单个服务更容易 开发和维护。 4）技术多元化 传统的开发模式一般是使用同类技术构建整 个应用。微服务架构强调的是去中心化的软件组 织架构，使每个服务根据自身服务的需求和行业发 展状况做出自己的判断，选择适合的技术类型，提 供接口服务。 5）降低维护风险 维 护 庞 大 且 复 杂 的 单 块 架 构 系 统 ，工 作 量 很 大，容易出现牵一发动全身，风险很高。相较而言，

微服务架构模式下，当某一组件发生故障时，不会 发现单块架构系统的进程内扩散等弊端，故障会被 隔 离 在 单 个 服 务 中 ，从 而 降 低 维 护 和 再 开 发 的 风 险。 2.3 微服务架构不足及应对措施［6~7］
1）微服务边界 应用微服务过程中，容易出现无法很好地界定 模块之间的界限，造成微服务过大或者过小。微服 务过大，会出现同单块架构系统类似的不足，微服 务过小，管理大量的服务也很复杂。 如何确定边界？采用业务领域模型驱动数据 模型设计方法，建立并完善整套业务领域模型，包 含上下文中关于边界的各项定义。这些明确的边 界将是微服务的边界，或是微服务边界内组件。 2）分布式应用的复杂性 分布式应用相比单体式应用，具有固有的复杂 性。需要在 RPC 或者消息传递之间选择并完成进 程间的通讯。更需要处理消息传递中速度过慢或 者不可用等局部失效问题。 充分考虑网络延迟、容错、消息序列化、不可靠 的网络、异步、版本控制、负载等对微服务的影响， 采用一整套完整的机制来保证各个服务可以正常 运转。 3）分区的数据库架构 在微服务架构应用中，一个微服务对应一个数 据库，需要更新不同服务所对应的不同数据库。才 能够时刻确保分布式数据系统当中不同形式数据 的一致性与并发性。 根据 CAP 定理，分布式系统中有三方面需要彼 此权衡：C（一致性）、A（可用性）和 P（分区容忍性）， 最多只能保证三个中的两个。做为一个系统整体， 不 需 要 全 部 是 AP 或 者 CP。 如 目 录 服 务 可 以 是 AP，因为不关注历史信息，但是数据台帐信息一般 需 要 CP，因 为 不 能 让 用 户 看 到 修 改 前 的 记 录 信 息。因此需要为每个服务调用做不同的权衡，来解 决微服务架构应用中分布式数据问题。 4）部署复杂 相比于单体式应用，一个微服务应用一般由大 批服务构成，且是多实例化的。这需要整个应用有 众多的配置、部署、扩展和监控功能。 通过使用 PaaS 服务实现部署自动化，PaaS 提 供一个部署和管理微服务的简单方法，它把所有这 些问题都打包内置。并使用一个集群化方案，比如 配合 Docker 容器技术使用 Mesos，在微服务层面提 供缓存、权限控制、API 统计和监控。

2018 年第 1 期

计算机与数字工程

151

3 基于微服务架构的设计

针对当前开发和维护的综合业务管理系统应 用过程中出现的单体结构应用无法解决的问题，对 其核心架构进行设计。
综合业务管理系统是一种两级业务系统，分为 一个集团级系统和 20 个所级系统，每个系统包含 合同管理子系统，计划管理子系统，项目管理子系 统，财务管理子系统，成果管理子系统，质量管理子 系统，器材管理子系统等 20 个子系统。从职能上 讲，集团级系统对所级系统有计划下发，项目监管， 财务预算等宏观总体上的把控，每个所级系统更关 注对计划执行，项目执行，财务结算，质量过程管理 等具体执行过程进行管理。集团级和所级系统既 有 共 性 ，又 有 区 别 。 不 同 的 所 级 系 统 由 于 独 立 运 作，组织结构和具体执行情况也有所区别。 3.1 微服务划分
根据当前系统建设的实际情况，将微服务分为 共享微服务和定制微服务。共享微服务又分为基 础平台共享微服务和业务共享微服务，都提供集团 级、所级系统相同的微服务。定制微服务是对共享 微服务无法满足单位实际业务需求的情况下的扩 展。表 1 列出系统部分微服务。

表 1 微服务列表

序号 1 2 3 4 5 6 … 1 2 3 4 5 … 1 2 3 4 5 …

分类 基础平台共享微服务
业务共享微服务
定制微服务

微服务名称 元数据管理微服务 工作流引擎微服务 文档插件微服务 报表工具微服务 备份恢复微服务 权限控制微服务 …… 计划下达微服务 项目监管微服务 财务预算微服务 质量计划下达微服务 合同谈判微服务 …… 计划执行微服务 项目执行微服务 财务结算微服务 质量运行情况微服务 合同谈判微服务 ……

各微服务都定义成独立的服务接口，相比于原 来单体结构的难以维护的情况，新的系统由实现不 同功能的微服务组成，每个微服务只关注单一的业

务功能。 3.2 微服务框架的选择
通过对主流开源微服务框架的比对，和现有系 统的实际情况：使用 Spring 作为容器框架、SpringM⁃ VC 作为模型控制器框架。故选择 Spring Cloud 作 为本系统的微服务应用框架，它能够与当前系统无 缝集成。
Spring Cloud［8］是一套完整的分布式系统解决 方案，从网关服务 Zuul，到服务发现 Eureka，再到 Hystrix 熔断机制，它的子项目涵盖所有实现分布 式系统所需要的基础软件设施。基于 Spring Boot， 使得开发部署变为简单，通过加依赖和注解，就能 运行。 3.3 微服务应用总体架构设计
微服务应用总体架构［6，9］如图 1 所示。
图 1 微服务应用总体架构图
由 Spring Cloud 组件和构建的微服务组成。通 过 Zuul 实 现 服 务 网 关 ，统 一 向 外 系 统 提 供 REST API；Ribbon 实现服务的消费以及均衡负载；Eureka 实 现 服 务 注 册 中 心 以 及 服 务 注 册 与 发 现 ；Spring Cloud Config 实现应用多环境的外部化配置以及版 本管理；Hystrix 的融断机制来避免在微服务架构中 个别服务出现异常时引起的故障蔓延。
定制微服务、业务共享微服务、基础平台共享 微服务都注册与订阅微服务到 Eureka，并通过均衡 负载向外提供微服务调用。各微服务都有对应的 独立业务数据子库。

152

洪华军等：一种基于微服务架构的业务系统设计与实现

第 46 卷

3.4 系统功能结构设计 提供一套完整的平台，由基础平台、业务共享
微服务共同构成，供集团、所两级使用。集团总部 将一套完整平台派发到 20 个所级单位。各所级单 位根据自身的实际业务情况，对完整平台的子系统 进行选配，构成本单位的综合管理业务系统。当实 际业务与完整平台不一致的情况，通过业务定制微 服务的方式，进行个性化定制开发，满足各单位的 实际需要。系统功能结构图，如下图 2 所示。
图 2 系统功能结构图
4 基于微服务架构的程序实现
4.1 创建 spring cloud 配置服务器 1）配置依赖 pom.xml［10］ <dependency> <groupId>org.springframework.cloud</groupId> <artifactId>spring-cloud-config-server</artifac⁃
tId> </dependency> 2）创 建 配 置 应 用 类 YwglConfigServerApplica⁃
tio n.java //在 springBoot 上构建项目 @SpringBootApplication //激活该应用为配置服务器 @EnableConfigServer public class YwglConfigServerApplication｛ public static void main（String［］args）｛ SpringApplication.run （YwglConfigServerAppli⁃
cation.class，args）； ｝｝ 3）配置访问路径 bootstrap.properties spring.application.name=configserver spring.cloud.config.uri=http：//192.168.8.8：8888

4.2 微服务注册 使用 eureka 作为 Spring cloud 的微服务注册及
发现。所有的服务端及访问微服务的客户端都需 要连接到 eureka。通过创建 ywgl-eureka-server 作 为 eureka 的服务端，提供注册服务［11］。
1）配置依赖 pom.xml <dependency> <groupId>org.springframework.cloud</groupId> <artifactId>spring-cloud-starter-eureka-server </artifactId> </dependency> 2）创建启动微服务类 YwglEurekaService Ap⁃ plication.java //在 springBoot 上构建项目 @SpringBootApplication //开启 eureka 服务，使应用成为 Eureka 服务器 @EnableEurekaServer public class YwglEurekaServiceApplication｛
//启动 spring boot public static void main（String［］args）｛ SpringApplication.run（YwglEurekaServiceAppli⁃ cation.class，args）； ｝｝ 3）访问配置 application.yml //eureka 服务器端口号 server.port=8444 //eureka 服务器访问地址 eureka.instance.hostname=192.168.8.8 //是否注册自身到 eureka 服务器 eureka.client.registerWithEureka=false //是否从 eureka 服务器获取注册信息 eureka.client.fetchRegistry=false //eureka 服务器所在的地址 eureka.client.serviceUrl.defaultZone=http：//$ ｛eureka.instance.hostname｝：$｛server.port｝/eureka/ 4.3 微服务发现和微服务应用 通过添加@EnableDiscoveryClient 注解，微服务 在启动时，将自动注册到 ywgl-eureka-server 注册 中心［13］。 1）配置依赖 pom.xml <dependency> <groupId>org.springframework.cloud</groupId> <artifactId>spring-cloud-starter-eureka</arti⁃ factId> </dependency>

2018 年第 1 期

计算机与数字工程

153

2）创建微服务发现类 YwglWebApplication.ja⁃
va //在 springBoot 上构建项目
@SpringBootApplication //通过该注解，实现微服务发现和注册
@EnableDiscoveryClient //配置本应用使用微服务注册和微服务发现
@EnableEurekaClient //启用断路器，断路器依赖于微服务注册和发 现
@EnableHystrix public class YwglWebApplication｛ public static void main（String［］args） throws Exception｛ SpringApplication.run （YwglWebApplication. class，args）； ｝｝ 3）Controller 层的 YwglPlanService 封装微服务 访问接口 YwglPlanService 类代码如下：
@Service public class YwglPlanService｛
@Autowired RestTemplate restTemplate； final String SERVICE_NAME=“ywgl”； //使用断路器 @HystrixCommand（fallbackMethod=“fallback⁃ GetPlan List”） public List<Plan> getPlanLis（t ）｛ //restTemplate 在 EurekaServer 查找微服务名称 所代表的微服务并调用 return restTemplate.getForObjec（t“http：//”+ SERVICE_NAME+“/planList”，List.class）； ｝ private List<Plan> fallbackGetPlanLis（t ）｛ List<Plan> planList= new ArrayList<Plan>（）； return planList； ｝｝ 4）在 YwglPlanController 类 中 注 入 YwglPlan⁃ Service 微服务
@RestController public class YwglPlanController｛
@Autowired YwglPlanService ywglPlanService； @RequestMapping（value=“/planList”）

public ResponseEntity<List<Plan>> getPlanList （）｛
List<Plan>planList= ywglPlanService.searchAl（l ）； Return new ResponseEntity<List<Plan>> （planList，HttpStatus.OK）； ｝｝ 5）前端 html 页面 前端 html 页面，使用 AngularJS，绑定模型数据 到页面变量［12］。planList.html 核心代码展示如下： <div> <ul ng-controller=“planListController”>
<li ng-repeat=“item in planList”> ｛｛item.planName｝｝ ｛｛item.planDate｝｝ ｛｛item.planResponser｝｝ </li> </ul> </div> 3）4）5）展示了计划管理中获取计划列表的微 服务程序实现，其他微服务按此方式进行创建。
5 结语
实现了一种基于微服务框架的业务系统设计 和实现。微服务具有高内聚性和高自治性。并有 组件化、独立部署、降低复杂度、技术多元化、降低 维护风险等优势。特别适合既有共性，又有区别的 集团、所两级的复杂业务系统的建设。为企业信息 化建设过程中遇到的问题提出了一种解决途径。
参考文献
［1］张晶，黄小锋. 一种基于微服务的应用框架［J］. 计算机 系统应用，2016，25（9）：265-270. ZHANG Jing，HUANG Xiaofeng.Application Framework Based on Microservice［J］. Computer Systems & Applica⁃ tions，2016，25（9）：265-270.
［2］杨宇，焦丽琴. 基于微服务的企业应用设计与实现［J］. 电子科学技术，2016（5）：623-625. YU Yang，JIAO Liqin. Enterprise Application Design and Implementation Based on Micro Service［J］. Electronic Science & Technology，2016（5）：623-625.
［3］纽曼. 微服务设计［M］. 北京：人民邮电出版社，2016. Sam Newman.Building Microservices［M］. Beijing：Posts and Telecom Press，2016.
［4］王磊. 微服务架构与实践［M］. 北京：北京电子工业出版 社，2016. WANG Lei. Microservices Architecture And Practice［M］.

154

洪华军等：一种基于微服务架构的业务系统设计与实现

第 46 卷

Beijing：Beijing Electronic Industry Publishing House， 2016. ［5］肖勤. 微服务架构实践经验分享［EB/OL］. http：//www. csdn.net/article/2015-08-07/2825412，2015-08-07. ［6］Chris Richardson.Introduction to Microservices［EB/OL］. https：//www.nginx.com/blog/introduction-to-microser⁃ vices，2015-05-19. ［7］Lychee Li. 微服务架构的优势与不足［EB/OL］. http：// blog.daocloud.io/microservices-1/utm_source=tuicool& utm_medium=referral，2016-05-04. ［8］ Qibaoguang.Spring-Boot-Reference-Guide ［EB/OL］. https：//github.com/qibaoguang/Spring-Boot-Reference-

Guide，2014-01-01. ［9］Fowler M，Lewis J. Microservices［EB/OL］. http：//martin⁃
fowler.com/articles/microservices.html，2014-05-25. ［10］Xsgong.spring-config-demo［EB/OL］. https：//git.oschi⁃
na.net/gongxusheng/spring-config-demo，2016-04-01. ［11］Spring.Service Registration and Discovery ［EB/OL］.
http：//spring.io/guides/gs/service-registration-and-dis⁃ covery，2016-01-01. ［12］Lzhou.spring-cloud-7simple［EB/OL］. http：//git.oschina. net/zhou666/spring-cloud-7simple，2015-05-01. ［13］Didi.SpringBoot-Learning［EB/OL］. https：//git.oschina. net/didispace/SpringBoot-Learning，2016-04-11.

􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍􀤍

（上接第 126 页）
6 结语
本文主要针对医疗行业 Web 应用程序进行了 基于 OWASP TOP 10 常见安全风险的渗透测试分 析和实施，给出了响应实例，并分析了测试结果，最 后给出了相应类型漏洞的常规防范措施。实际情 况中，每一类漏洞或风险对应的情况和被利用的方 式错综复杂，需要渗透测试人员时刻跟踪业界最新 动态。后续工作将主要集中在以下方面：一是考虑 引入不同风险评估模型对漏洞进行重新归类和风 险评估；二是针对漏洞发生情况，采用基于场景模 拟的测试方法，针对如登录、支付、修改权限等重要 功能模块进行针对性渗透测试；三是为主要漏洞寻 找行之有效的解决方案，发现和弥补系统漏洞，保 障系统的安全稳定运行。
参考文献
［1］赵翀，高鹏. 渗透测试在软件测试中的应用［J］. 计算机 与数学工程，2010，38（5）：102-104. ZHAO Chong，GAO Peng. Application of Penetration Test in Software Testing［J］. Computer & Digital Engineering， 2010，38（5）：102-104.
［2］ Stuart McClure，Joel Scambray，George Kurtz. Hacking Exposed 7：Network Security Secrets & Solutions［M］. McGraw-Hill，August 2012：105-120.
［3］宋超臣，王希忠，黄俊强，等. Web 渗透测试流程研究 ［J］. 电子设计工程，2014，22（17）：165-167. SONG Chaochen，WANG Xizhong，HUANG Junqiang，et al. Web Penetration Testing Process Research［J］. Elec⁃ tronic Design Engineering，2014，22（17）：165-167.
［4］吴翰清. 白帽子讲 Web 安全［M］. 北京：电子工业出版 社，2012：27-29.

WU Hanqing. White Hat Hackers Talk about Web Security ［M］. Beijing：Publishing House of Electronics Industry， 2012：27-29. ［5］陈小兵，张汉煜，骆力明，等. SQL 注入攻击及其防范检 测 技 术 研 究［J］. 计 算 机 工 程 与 应 用 ，2007，43（11）： 150-152. CHEN Xiaobing，ZHANG Hanyu，LUO Liming，et al. Re⁃ search on SQL Injection Attack and Detection Technology ［J］. Compute Engineering Application，2007，43（11）： 150-152. ［6］徐光. 基于 Kali Linux 的 Web 渗透测试研究［J］. 信息安 全与技术，2015，3：56-58. XU Guang. Study of KaIi-Linux Web based on Penetra⁃ tion Testing［J］. Information Security and Technology， 2015，3：56-58. ［7］达斯孟，陆永忠，宁峰. 客户端跨站脚本攻击的分层防 御策略［J］. 计算机系统应用，2010，19（2）：29-32. DA Simeng，LU Yongzhong，NING Feng. Layered Defense Strategy of the Cross-Site Scripting Attack on Client-Side ［J］. Computer System Application，2010，19（2）：29-32. ［8］钟晨鸣，徐少培. Web 前端黑客技术揭秘［M］. 北京：电 子工业出版社，2013：35-40. ZHONG Chenming，XU Shaopei. Secrets of Web Hacker Technology［M］. Beijing：Publishing House of Electronics Industry，2013：35-40. ［9］PD Ryck，L Desmet，W Joosen，F Piessens. Automatic and Precise Client-side Protection Against CSRF Attacks［J］. Lecture Notes in Computer Science，2011，6879：100-116. ［10］张彦超，梅丹，韩佳琳.“心脏流血”安全漏洞分析及应
对建议［J］. 现代电信科技，2014（10）：40-42. ZHANG Yanchao，MEI Dan，HAN Jialin. Analysis and Suggestions on Heart-bleeding Vulnerability［J］. Modern Science & Technology of Telecommunications，2014 （10）：40-42.

